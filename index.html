<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•˜ì´íƒ‘ë¶€ë™ì‚° í†µí•© ê³„ì‚°ê¸°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding: 40px 20px;
        }

        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .subtitle {
            font-size: 1.1em;
            opacity: 0.95;
        }

        .tab-container {
            background: white;
            border-radius: 15px 15px 0 0;
            overflow: hidden;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.1);
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
            background: none;
            font-size: 0.9em;
            color: #666;
            min-width: 80px;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active {
            background: white;
            color: #667eea;
            font-weight: bold;
            border-bottom: 3px solid #667eea;
        }

        .calculator {
            display: none;
            padding: 40px;
            background: white;
        }

        .calculator.active {
            display: block;
        }

        .calculator h2 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.8em;
        }

        .calculator > p {
            color: #666;
            margin-bottom: 30px;
        }

        .input-group {
            margin-bottom: 25px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 500;
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-group small {
            display: block;
            margin-top: 5px;
            color: #999;
            font-size: 0.9em;
        }

        /* ê¸ˆì•¡ ë¯¸ë¦¬ë³´ê¸° */
        .amount-preview {
            display: none;
            margin-top: 6px;
            padding: 6px 10px;
            background: #f0f4ff;
            border-radius: 6px;
            color: #667eea;
            font-size: 0.95em;
            font-weight: 600;
        }
        .amount-preview.show {
            display: block;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin: 30px 0;
        }

        button {
            flex: 1;
            padding: 15px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #e9ecef;
            color: #666;
        }

        .btn-secondary:hover {
            background: #dee2e6;
        }

        .result {
            display: none;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 30px;
            border-radius: 12px;
            margin-top: 30px;
        }

        .result.show {
            display: block;
            animation: slideIn 0.5s;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .result-item:last-child {
            margin-bottom: 0;
        }

        .result-label {
            color: #666;
            font-weight: 500;
        }

        .result-value {
            color: #667eea;
            font-weight: bold;
            font-size: 1.2em;
        }

        .highlight {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 1.2em;
        }

        .highlight .result-label,
        .highlight .result-value {
            color: white !important;
        }

        .notice {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-top: 20px;
            border-radius: 4px;
            color: #856404;
        }

        .notice strong {
            display: block;
            margin-bottom: 5px;
        }

        /* ê²°ê³¼ ì„¤ëª… ë°•ìŠ¤ */
        .result-explanation {
            background: #e8f4fd;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-top: 15px;
            border-radius: 4px;
            color: #334;
            font-size: 0.95em;
            line-height: 1.7;
        }
        .result-explanation strong {
            display: block;
            margin-bottom: 6px;
            color: #667eea;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        th, td {
            padding: 12px;
            text-align: center;
            border: 1px solid #dee2e6;
        }

        th {
            background: #f8f9fa;
            font-weight: bold;
            color: #333;
        }

        footer {
            text-align: center;
            color: white;
            margin-top: 40px;
            padding: 20px;
            opacity: 0.9;
        }

        footer a {
            color: white;
            text-decoration: none;
            font-weight: bold;
        }

        .toggle-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 30px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider { background-color: #667eea; }
        input:checked + .slider:before { transform: translateX(30px); }

        .loan-section {
            display: none;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-top: 15px;
            border: 2px solid #667eea;
        }

        .loan-section.show { display: block; }

        /* ì„ íƒ ë²„íŠ¼ ê·¸ë£¹ */
        .btn-select-group {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        .sel-btn {
            flex: none;
            padding: 9px 18px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            background: white;
            color: #666;
            font-size: 0.95em;
            font-weight: 600;
            transition: all 0.2s;
        }
        .sel-btn:hover { border-color: #667eea; color: #667eea; }
        .sel-btn.active { border-color: #667eea; background: #667eea; color: white; }

        /* ì „ì›”ì„¸ ì „í™˜ íƒ­ ìŠ¤íƒ€ì¼ */
        .conversion-direction {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .direction-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            background: white;
            color: #666;
            font-size: 0.95em;
            font-weight: 600;
            transition: all 0.3s;
        }
        .direction-btn.active {
            border-color: #667eea;
            background: #f0f4ff;
            color: #667eea;
        }

        @media (max-width: 768px) {
            h1 { font-size: 1.8em; }
            .tab { flex-basis: 33.33%; padding: 12px 6px; font-size: 0.78em; }
            .calculator { padding: 20px; }
            .result-item { flex-direction: column; gap: 5px; }
        }
    </style>
</head>
<body>
<div class="container">
    <header>
        <h1>ğŸ“Š í•˜ì´íƒ‘ë¶€ë™ì‚° í†µí•© ê³„ì‚°ê¸°</h1>
        <p class="subtitle">ìƒê°€ íˆ¬ìë¶€í„° ì„ëŒ€ë£Œ, ì·¨ë“ì„¸, ì¤‘ê°œìˆ˜ìˆ˜ë£Œê¹Œì§€ í•œ ë²ˆì— ê³„ì‚°í•˜ì„¸ìš”</p>
    </header>

    <div class="tab-container">
        <div class="tabs">
            <button class="tab active" onclick="switchTab(0)">ğŸ“ˆ ìƒê°€ ìˆ˜ìµë¥ </button>
            <button class="tab" onclick="switchTab(1)">ğŸ“Š ì„ëŒ€ë£Œ ì¸ìƒ</button>
            <button class="tab" onclick="switchTab(2)">ğŸ”„ ì „ì›”ì„¸ ì „í™˜</button>
            <button class="tab" onclick="switchTab(3)">ğŸ’° ì·¨ë“ì„¸</button>
            <button class="tab" onclick="switchTab(4)">ğŸ¤ ì¤‘ê°œìˆ˜ìˆ˜ë£Œ</button>
            <button class="tab" onclick="switchTab(5)">ğŸ“‹ ì ì • ì›”ì„¸</button>
            <button class="tab" onclick="switchTab(6)">ğŸ¢ ì ì • ë§¤ë§¤ê°€</button>
            <button class="tab" onclick="switchTab(7)">ğŸ“ í‰ë‹¹ê°€ ê³„ì‚°</button>
        </div>

        <!-- ===== ìƒê°€ ìˆ˜ìµë¥  ê³„ì‚°ê¸° ===== -->
        <div class="calculator active" id="calc-0">
            <h2>ìƒê°€ ìˆ˜ìµë¥  ê³„ì‚°ê¸°</h2>
            <p>ì •í™•í•œ íˆ¬ì ë¶„ì„ìœ¼ë¡œ ì„±ê³µì ì¸ ìƒê°€ íˆ¬ìë¥¼ ì‹¤í˜„í•˜ì„¸ìš”</p>

            <div class="toggle-container">
                <label for="includeLoan"><strong>ëŒ€ì¶œ í¬í•¨</strong></label>
                <label class="toggle-switch">
                    <input type="checkbox" id="includeLoan" onchange="toggleLoan()">
                    <span class="slider"></span>
                </label>
            </div>

            <div class="input-group">
                <label for="price">ë§¤ë§¤ê°€ (ì›)</label>
                <input type="text" inputmode="numeric" id="price" placeholder="ì˜ˆ: 300,000,000" oninput="fmtInput(this); showPreview(this, 'price-preview')">
                <div class="amount-preview" id="price-preview"></div>
            </div>

            <div class="input-group">
                <label for="rent">ì›” ì„ëŒ€ë£Œ (ì›)</label>
                <input type="text" inputmode="numeric" id="rent" placeholder="ì˜ˆ: 1,500,000" oninput="fmtInput(this); showPreview(this, 'rent-preview')">
                <div class="amount-preview" id="rent-preview"></div>
            </div>

            <div class="input-group">
                <label for="deposit">ë³´ì¦ê¸ˆ (ì›)</label>
                <input type="text" inputmode="numeric" id="deposit" placeholder="ì˜ˆ: 50,000,000" oninput="fmtInput(this); showPreview(this, 'deposit-preview')">
                <div class="amount-preview" id="deposit-preview"></div>
            </div>

            <div class="loan-section" id="loanSection">
                <div class="input-group">
                    <label for="loanAmount">ëŒ€ì¶œê¸ˆì•¡ (ì›)</label>
                    <input type="text" inputmode="numeric" id="loanAmount" placeholder="ì˜ˆ: 200,000,000" oninput="fmtInput(this); showPreview(this, 'loanAmount-preview')">
                    <div class="amount-preview" id="loanAmount-preview"></div>
                    <small>ì´ ë§¤ë§¤ê°€ ì¤‘ ëŒ€ì¶œë°›ëŠ” ê¸ˆì•¡</small>
                </div>
                <div class="input-group">
                    <label for="loanRate">ëŒ€ì¶œê¸ˆë¦¬ (%)</label>
                    <input type="text" inputmode="decimal" id="loanRate" placeholder="ì˜ˆ: 4.5">
                    <small>ì—° ì´ììœ¨</small>
                </div>
            </div>

            <div class="button-group">
                <button class="btn-primary" onclick="calculateYield()">ê³„ì‚°í•˜ê¸°</button>
                <button class="btn-secondary" onclick="resetYield()">ì´ˆê¸°í™”</button>
            </div>

            <div class="result" id="yieldResult">
                <div class="result-item">
                    <span class="result-label">ë§¤ë§¤ê°€</span>
                    <span class="result-value" id="salePriceDisplay">0ì›</span>
                </div>
                <div class="result-item">
                    <span class="result-label">ì·¨ë“ì„¸ (4.6%)</span>
                    <span class="result-value" id="taxDisplay">0ì›</span>
                </div>
                <div class="result-item">
                    <span class="result-label">ì—°ê°„ ì„ëŒ€ìˆ˜ìµ</span>
                    <span class="result-value" id="annualRent">0ì›</span>
                </div>
                <div class="result-item" id="loanInterestRow" style="display:none;">
                    <span class="result-label">ì—°ê°„ ëŒ€ì¶œì´ì</span>
                    <span class="result-value" id="annualLoanInterest">0ì›</span>
                </div>
                <div class="result-item">
                    <span class="result-label">ì‹¤íˆ¬ìê¸ˆ (ë³´ì¦ê¸ˆ ì œì™¸)</span>
                    <span class="result-value" id="actualInvestment">0ì›</span>
                </div>
                <div class="result-item highlight">
                    <span class="result-label">ì‹¤ì§ˆ ìˆ˜ìµë¥ </span>
                    <span class="result-value" id="yieldRate">0%</span>
                </div>
                <div class="result-explanation" id="yieldExplanation"></div>
                <div class="notice">
                    <strong>ğŸ’¡ ìˆ˜ìµë¥  ê³„ì‚° ë°©ë²•</strong>
                    <p style="margin:8px 0 5px 0;">
                        <strong>ëŒ€ì¶œ ë¯¸í¬í•¨:</strong> ì‹¤íˆ¬ìê¸ˆ = ë§¤ë§¤ê°€ - ë³´ì¦ê¸ˆ<br>
                        ìˆ˜ìµë¥  = (ì—°ê°„ ì„ëŒ€ë£Œ Ã· ì‹¤íˆ¬ìê¸ˆ) Ã— 100
                    </p>
                    <p style="margin:5px 0;">
                        <strong>ëŒ€ì¶œ í¬í•¨:</strong> ì‹¤íˆ¬ìê¸ˆ = ë§¤ë§¤ê°€ - ëŒ€ì¶œê¸ˆ - ë³´ì¦ê¸ˆ<br>
                        ìˆ˜ìµë¥  = ((ì—°ê°„ ì„ëŒ€ë£Œ - ì—°ê°„ ì´ì) Ã· ì‹¤íˆ¬ìê¸ˆ) Ã— 100
                    </p>
                    <p style="margin:10px 0 0 0; padding-top:10px; border-top:1px solid #ddd;">
                        â€» ì·¨ë“ì„¸ëŠ” ì°¸ê³ ìš©ì´ë©° ìˆ˜ìµë¥  ê³„ì‚°ì— í¬í•¨ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.<br>
                        â€» ì‹¤ì œ ìˆœìˆ˜ìµë¥ ì€ ê´€ë¦¬ë¹„, ì¬ì‚°ì„¸, ê³µì‹¤ë¥  ë“±ì„ ì¶”ê°€ë¡œ ê³ ë ¤í•´ì•¼ í•©ë‹ˆë‹¤.
                    </p>
                </div>
            </div>
        </div>

        <!-- ===== ì„ëŒ€ë£Œ ì¸ìƒ ê³„ì‚°ê¸° ===== -->
        <div class="calculator" id="calc-1">
            <h2>ì„ëŒ€ë£Œ ì¸ìƒ ê³„ì‚°ê¸°</h2>
            <p>ì„ëŒ€ì°¨ ê°±ì‹  ì‹œ ì¸ìƒë¥ (ê¸°ë³¸ 5%)ì„ ì ìš©í•œ ë³€ê²½ í›„ ì„ëŒ€ë£Œë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤</p>

            <div class="input-group">
                <label for="currentDeposit">í˜„ì¬ ë³´ì¦ê¸ˆ (ì›)</label>
                <input type="text" inputmode="numeric" id="currentDeposit" placeholder="í˜„ì¬ ê³„ì•½ ì¤‘ì¸ ë³´ì¦ê¸ˆ" oninput="fmtInput(this); showPreview(this, 'currentDeposit-preview')">
                <div class="amount-preview" id="currentDeposit-preview"></div>
            </div>

            <div class="input-group">
                <label for="currentRent">í˜„ì¬ ì›”ì„¸ (ì›)</label>
                <input type="text" inputmode="numeric" id="currentRent" placeholder="í˜„ì¬ ê³„ì•½ ì¤‘ì¸ ì›”ì„¸ (ì—†ìœ¼ë©´ 0)" oninput="fmtInput(this); showPreview(this, 'currentRent-preview')">
                <div class="amount-preview" id="currentRent-preview"></div>
            </div>

            <div class="input-group">
                <label for="newDeposit">ë³€ê²½ í›„ ë³´ì¦ê¸ˆ (ì›)</label>
                <input type="text" inputmode="numeric" id="newDeposit" placeholder="ë³€ê²½í•˜ë ¤ëŠ” ë³´ì¦ê¸ˆ (ê·¸ëŒ€ë¡œë©´ í˜„ì¬ ë³´ì¦ê¸ˆ ì…ë ¥)" oninput="fmtInput(this); showPreview(this, 'newDeposit-preview')">
                <div class="amount-preview" id="newDeposit-preview"></div>
            </div>

            <div class="input-group">
                <label for="increaseRate">ì„ëŒ€ë£Œ ì¸ìƒë¥  (%)</label>
                <input type="text" inputmode="decimal" id="increaseRate" value="5">
                <small>ì£¼íƒì„ëŒ€ì°¨ë³´í˜¸ë²• ìƒí•œ: 5% / ë³€ê²½ì´ í•„ìš”í•  ë•Œë§Œ ìˆ˜ì •í•˜ì„¸ìš”</small>
            </div>

            <div class="input-group">
                <label for="monthlyConvRate">ì›”ì°¨ì„ì „í™˜ì‹œì‚°ì •ë¥  (%)</label>
                <input type="text" inputmode="decimal" id="monthlyConvRate" value="2">
                <small>ë²•ì • ì›”ì°¨ì„ì „í™˜ìœ¨ (í†µìƒ 2%)</small>
            </div>

            <div class="input-group">
                <label for="baseRate">í•œêµ­ì€í–‰ ê¸°ì¤€ê¸ˆë¦¬ (%)</label>
                <input type="text" inputmode="decimal" id="baseRate" value="2.5">
                <small>í˜„ì¬ ê¸°ì¤€ê¸ˆë¦¬ ì…ë ¥ (2025ë…„ ê¸°ì¤€ ì•½ 2.5%)</small>
            </div>

            <div class="button-group">
                <button class="btn-primary" onclick="calculateRentIncrease()">ê³„ì‚°í•˜ê¸°</button>
                <button class="btn-secondary" onclick="resetRentIncrease()">ì´ˆê¸°í™”</button>
            </div>

            <div class="result" id="rentResult">
                <table>
                    <tr>
                        <th>í•­ëª©</th>
                        <th>ë³€ê²½ ì „</th>
                        <th>ë³€ê²½ í›„</th>
                    </tr>
                    <tr>
                        <td>ì„ëŒ€ë³´ì¦ê¸ˆ(ì›)</td>
                        <td id="beforeDeposit">0</td>
                        <td id="afterDeposit">0</td>
                    </tr>
                    <tr>
                        <td>ì›” ì„ëŒ€ë£Œ(ì›)</td>
                        <td id="beforeRent">0</td>
                        <td id="afterRent">0</td>
                    </tr>
                    <tr>
                        <td>ì—° ì„ëŒ€ë£Œ(ì›)</td>
                        <td id="beforeAnnualRent">0</td>
                        <td id="afterAnnualRent">0</td>
                    </tr>
                </table>
                <div class="result-explanation" id="rentExplanation"></div>
                <div class="notice">
                    ì£¼íƒì„ëŒ€ì°¨ë³´í˜¸ë²• ì œ7ì¡°ì˜2ì— ë”°ë¼ ì„ëŒ€ë£Œ ì¦ì•¡ì€ 5%ë¥¼ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>
                    ë³´ì¦ê¸ˆ ë³€ê²½ ì‹œ ì „ì›”ì„¸ì „í™˜ìœ¨ì„ ì ìš©í•˜ì—¬ ì›”ì„¸ë¥¼ ì¡°ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </div>
            </div>
        </div>

        <!-- ===== ì „ì›”ì„¸ ì „í™˜ ê³„ì‚°ê¸° (NEW) ===== -->
        <div class="calculator" id="calc-2">
            <h2>ì „ì›”ì„¸ ì „í™˜ ê³„ì‚°ê¸°</h2>
            <p>ì „ì„¸â†’ì›”ì„¸ ë˜ëŠ” ì›”ì„¸â†’ì „ì„¸ ì „í™˜ ì‹œ ì ì • ê¸ˆì•¡ì„ ê³„ì‚°í•©ë‹ˆë‹¤</p>

            <div class="conversion-direction">
                <button class="direction-btn active" id="btnJeonToWol" onclick="setDirection('jeonToWol')">ğŸ  ì „ì„¸ â†’ ì›”ì„¸</button>
                <button class="direction-btn" id="btnWolToJeon" onclick="setDirection('wolToJeon')">ğŸ’µ ì›”ì„¸ â†’ ì „ì„¸</button>
            </div>

            <!-- ì „ì„¸â†’ì›”ì„¸ -->
            <div id="jeonToWolSection">
                <div class="input-group">
                    <label for="jeonDeposit">í˜„ì¬ ì „ì„¸ê¸ˆ (ì›)</label>
                    <input type="text" inputmode="numeric" id="jeonDeposit" placeholder="ì˜ˆ: 200,000,000" oninput="fmtInput(this); showPreview(this, 'jeonDeposit-preview')">
                    <div class="amount-preview" id="jeonDeposit-preview"></div>
                </div>
                <div class="input-group">
                    <label for="newWolDeposit">ë³€ê²½ ë³´ì¦ê¸ˆ (ì›)</label>
                    <input type="text" inputmode="numeric" id="newWolDeposit" placeholder="ì›”ì„¸ ì „í™˜ í›„ ë³´ì¦ê¸ˆ (0ì› ê°€ëŠ¥)" oninput="fmtInput(this); showPreview(this, 'newWolDeposit-preview')">
                    <div class="amount-preview" id="newWolDeposit-preview"></div>
                </div>
            </div>

            <!-- ì›”ì„¸â†’ì „ì„¸ -->
            <div id="wolToJeonSection" style="display:none;">
                <div class="input-group">
                    <label for="wolDeposit">í˜„ì¬ ë³´ì¦ê¸ˆ (ì›)</label>
                    <input type="text" inputmode="numeric" id="wolDeposit" placeholder="ì˜ˆ: 10,000,000" oninput="fmtInput(this); showPreview(this, 'wolDeposit-preview')">
                    <div class="amount-preview" id="wolDeposit-preview"></div>
                </div>
                <div class="input-group">
                    <label for="wolRent">í˜„ì¬ ì›”ì„¸ (ì›)</label>
                    <input type="text" inputmode="numeric" id="wolRent" placeholder="ì˜ˆ: 800,000" oninput="fmtInput(this); showPreview(this, 'wolRent-preview')">
                    <div class="amount-preview" id="wolRent-preview"></div>
                </div>
            </div>

            <div class="input-group">
                <label for="conversionRate2">ì „ì›”ì„¸ ì „í™˜ìœ¨ (%)</label>
                <input type="text" inputmode="decimal" id="conversionRate2" value="5.0">
                <small>ë²•ì • ì „ì›”ì„¸ ì „í™˜ìœ¨: ê¸°ì¤€ê¸ˆë¦¬ + 2% (í˜„ì¬ ì•½ 5.0%)</small>
            </div>

            <div class="button-group">
                <button class="btn-primary" onclick="calculateConversion()">ê³„ì‚°í•˜ê¸°</button>
                <button class="btn-secondary" onclick="resetConversion()">ì´ˆê¸°í™”</button>
            </div>

            <div class="result" id="conversionResult">
                <div class="result-item">
                    <span class="result-label" id="convResult1Label">ì „ì„¸ê¸ˆ</span>
                    <span class="result-value" id="convResult1Value">0ì›</span>
                </div>
                <div class="result-item">
                    <span class="result-label" id="convResult2Label">ë³€ê²½ ë³´ì¦ê¸ˆ</span>
                    <span class="result-value" id="convResult2Value">0ì›</span>
                </div>
                <div class="result-item">
                    <span class="result-label" id="convResult3Label">ì „í™˜ ê¸°ì¤€ê¸ˆì•¡</span>
                    <span class="result-value" id="convResult3Value">0ì›</span>
                </div>
                <div class="result-item highlight">
                    <span class="result-label" id="convResultMainLabel">ì›”ì„¸</span>
                    <span class="result-value" id="convResultMain">0ì›</span>
                </div>
                <div class="result-explanation" id="convExplanation"></div>
                <div class="notice">
                    <strong>ğŸ’¡ ì „ì›”ì„¸ ì „í™˜ìœ¨ ê³µì‹</strong>
                    <p style="margin:8px 0 5px 0;">
                        <strong>ì „ì„¸â†’ì›”ì„¸:</strong> ì›”ì„¸ = (ì „ì„¸ê¸ˆ - ë³€ê²½ë³´ì¦ê¸ˆ) Ã— ì „í™˜ìœ¨ Ã· 12<br>
                        <strong>ì›”ì„¸â†’ì „ì„¸:</strong> ì „ì„¸ê¸ˆ = ë³´ì¦ê¸ˆ + (ì›”ì„¸ Ã— 12 Ã· ì „í™˜ìœ¨)
                    </p>
                    <p style="margin:10px 0 0 0; padding-top:10px; border-top:1px solid #ddd;">
                        â€» ë²•ì • ì „ì›”ì„¸ ì „í™˜ìœ¨: í•œêµ­ì€í–‰ ê¸°ì¤€ê¸ˆë¦¬ + 2%p<br>
                        â€» ì‹¤ì œ ì ìš© ì „í™˜ìœ¨ì€ ì„ëŒ€ì¸Â·ì„ì°¨ì¸ í˜‘ì˜ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>
                </div>
            </div>
        </div>

        <!-- ===== ì·¨ë“ì„¸ ê³„ì‚°ê¸° ===== -->
        <div class="calculator" id="calc-3">
            <h2>ì·¨ë“ì„¸ ê³„ì‚°ê¸°</h2>
            <p>2026ë…„ ê¸°ì¤€ ë¶€ë™ì‚° ìœ í˜•Â·ì£¼íƒ ìˆ˜Â·ë©´ì ë³„ ì·¨ë“ì„¸ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤</p>

            <!-- ì·¨ë“ ìœ í˜• -->
            <div class="input-group">
                <label>ì·¨ë“ ìœ í˜•</label>
                <div class="btn-select-group" id="acqTypeGroup">
                    <button class="sel-btn active" onclick="setAcqType('buy', this)">ë§¤ë§¤</button>
                    <button class="sel-btn" onclick="setAcqType('gift', this)">ì¦ì—¬</button>
                    <button class="sel-btn" onclick="setAcqType('inherit', this)">ìƒì†</button>
                </div>
            </div>

            <!-- ìì‚° ìœ í˜• -->
            <div class="input-group" id="assetTypeGroup">
                <label>ìì‚° ìœ í˜•</label>
                <div class="btn-select-group" id="assetBtnGroup">
                    <button class="sel-btn active" onclick="setAssetType('house', this)">ì£¼íƒ</button>
                    <button class="sel-btn" onclick="setAssetType('officetel', this)">ì˜¤í”¼ìŠ¤í…”</button>
                    <button class="sel-btn" onclick="setAssetType('farmland', this)">ë†ì§€</button>
                    <button class="sel-btn" onclick="setAssetType('commercial', this)">ìƒê°€Â·í† ì§€</button>
                </div>
            </div>

            <!-- ì£¼íƒ ê´€ë ¨ ì˜µì…˜ -->
            <div id="houseOptions">
                <div class="input-group">
                    <label>ë²•ì¸ ì—¬ë¶€</label>
                    <div class="btn-select-group" id="corpGroup">
                        <button class="sel-btn active" onclick="setCorp(false, this)">ê°œì¸</button>
                        <button class="sel-btn" onclick="setCorp(true, this)">ë²•ì¸</button>
                    </div>
                </div>
                <div class="input-group" id="houseCountGroup">
                    <label>ì£¼íƒ ìˆ˜ (ì·¨ë“ í›„ ê¸°ì¤€)</label>
                    <div class="btn-select-group" id="houseCountBtnGroup">
                        <button class="sel-btn active" onclick="setHouseCount(1, this)">1ì£¼íƒ</button>
                        <button class="sel-btn" onclick="setHouseCount(2, this)">2ì£¼íƒ</button>
                        <button class="sel-btn" onclick="setHouseCount(3, this)">3ì£¼íƒ</button>
                        <button class="sel-btn" onclick="setHouseCount(4, this)">4ì£¼íƒâ†‘</button>
                    </div>
                </div>
                <div class="input-group" id="adjustedAreaGroup2">
                    <label>ì¡°ì •ëŒ€ìƒì§€ì—­ ì—¬ë¶€</label>
                    <div class="btn-select-group" id="adjAreaBtnGroup">
                        <button class="sel-btn active" onclick="setAdjArea(false, this)">ì¼ë°˜ì§€ì—­</button>
                        <button class="sel-btn" onclick="setAdjArea(true, this)">ì¡°ì •ëŒ€ìƒì§€ì—­</button>
                    </div>
                </div>
                <div class="input-group">
                    <label>ì „ìš©ë©´ì </label>
                    <div class="btn-select-group" id="areaBtnGroup">
                        <button class="sel-btn active" onclick="setArea(false, this)">85ã¡ ì´í•˜</button>
                        <button class="sel-btn" onclick="setArea(true, this)">85ã¡ ì´ˆê³¼</button>
                    </div>
                </div>
            </div>

            <!-- ì˜¤í”¼ìŠ¤í…” ìš©ë„ -->
            <div class="input-group" id="officetelUseGroup" style="display:none;">
                <label>ì˜¤í”¼ìŠ¤í…” ìš©ë„</label>
                <div class="btn-select-group" id="officetelUseBtnGroup">
                    <button class="sel-btn active" onclick="setOfficetelUse('business', this)">ì—…ë¬´ìš©</button>
                    <button class="sel-btn" onclick="setOfficetelUse('residential', this)">ì£¼ê±°ìš©</button>
                </div>
            </div>

            <!-- ë†ì§€ ì˜µì…˜ -->
            <div class="input-group" id="farmlandGroup" style="display:none;">
                <label>ë†ì§€ êµ¬ë¶„</label>
                <div class="btn-select-group" id="farmlandTypeBtnGroup">
                    <button class="sel-btn active" onclick="setFarmlandType('general', this)">ì¼ë°˜ë†ì§€ (ë¹„ìê²½)</button>
                    <button class="sel-btn" onclick="setFarmlandType('selfcult', this)">ìê²½ë†ì§€ (2ë…„â†‘ ê²½ì‘)</button>
                    <button class="sel-btn" onclick="setFarmlandType('agcorp_new', this)">ë†ì—…ë²•ì¸ (ì„¤ë¦½ 2ë…„ë‚´)</button>
                    <button class="sel-btn" onclick="setFarmlandType('agcorp', this)">ë†ì—…ë²•ì¸ (ì˜ë†Â·ìœ í†µÂ·ê°€ê³µ)</button>
                </div>
                <small id="farmlandNote">ìê²½ë†ì§€: ì·¨ë“ì„¸ 50% ê²½ê° (3%â†’1.5%), ì§€ë°©êµìœ¡ì„¸ìœ¨ 0.1% ë³„ë„ ì ìš©</small>
            </div>

            <!-- ì·¨ë“ê°€ì•¡ -->
            <div class="input-group">
                <label for="acquisitionPrice">ì·¨ë“ê°€ì•¡ (ì›)</label>
                <input type="text" inputmode="numeric" id="acquisitionPrice" placeholder="ì‹¤ê±°ë˜ê°€ ê¸°ì¤€" oninput="fmtInput(this); showPreview(this, 'acquisitionPrice-preview')">
                <div class="amount-preview" id="acquisitionPrice-preview"></div>
            </div>

            <div class="button-group">
                <button class="btn-primary" onclick="calculateAcquisitionTax()">ê³„ì‚°í•˜ê¸°</button>
                <button class="btn-secondary" onclick="resetAcquisitionTax()">ì´ˆê¸°í™”</button>
            </div>

            <div class="result" id="taxResult">
                <!-- ì„¸ìœ¨ ìš”ì•½ ë±ƒì§€ -->
                <div style="text-align:center; margin-bottom:15px;">
                    <span id="taxRateBadge" style="display:inline-block; background:linear-gradient(135deg,#667eea,#764ba2); color:white; padding:8px 24px; border-radius:20px; font-size:1.1em; font-weight:700;"></span>
                </div>
                <div class="result-item">
                    <span class="result-label" id="acquisitionTaxLabel">ì·¨ë“ì„¸</span>
                    <span class="result-value" id="acquisitionTaxAmount">0ì›</span>
                </div>
                <div class="result-item">
                    <span class="result-label" id="eduTaxLabel">ì§€ë°©êµìœ¡ì„¸</span>
                    <span class="result-value" id="educationTax">0ì›</span>
                </div>
                <div class="result-item">
                    <span class="result-label" id="ruralTaxLabel">ë†ì–´ì´ŒíŠ¹ë³„ì„¸</span>
                    <span class="result-value" id="ruralTax">0ì›</span>
                </div>
                <div class="result-item highlight">
                    <span class="result-label">ì´ ë‚©ë¶€ì„¸ì•¡</span>
                    <span class="result-value" id="totalTax">0ì›</span>
                </div>
                <div class="result-explanation" id="taxExplanation"></div>

                <!-- ì„¸ìœ¨í‘œ -->
                <div class="notice" style="margin-top:15px;">
                    <strong>ğŸ“‹ ì£¼íƒ ì·¨ë“ì„¸ìœ¨í‘œ (2026ë…„ ê¸°ì¤€)</strong>
                    <table style="margin-top:10px; font-size:0.85em;">
                        <tr><th>êµ¬ë¶„</th><th>ì·¨ë“ê°€ì•¡</th><th>ì·¨ë“ì„¸ìœ¨</th><th>ë†íŠ¹ì„¸</th><th>í•©ê³„</th></tr>
                        <tr><td rowspan="3">1ì£¼íƒ</td><td>6ì–µ ì´í•˜</td><td>1%</td><td>85ã¡ì´ˆê³¼ 0.2%</td><td>1.1~1.3%</td></tr>
                        <tr><td>6ì–µ~9ì–µ</td><td>1~3% ëˆ„ì§„</td><td>85ã¡ì´ˆê³¼ 0.2%</td><td>ëˆ„ì§„</td></tr>
                        <tr><td>9ì–µ ì´ˆê³¼</td><td>3%</td><td>85ã¡ì´ˆê³¼ 0.2%</td><td>3.3~3.5%</td></tr>
                        <tr><td>2ì£¼íƒ(ì¼ë°˜)</td><td>-</td><td>1~3%</td><td>85ã¡ì´ˆê³¼ 0.2%</td><td>-</td></tr>
                        <tr><td>2ì£¼íƒ(ì¡°ì •)</td><td>-</td><td>8%</td><td>0.2%</td><td>ì•½ 9%</td></tr>
                        <tr><td>3ì£¼íƒ(ì¼ë°˜)</td><td>-</td><td>8%</td><td>0.2%</td><td>ì•½ 9%</td></tr>
                        <tr><td>3ì£¼íƒ(ì¡°ì •)</td><td>-</td><td>12%</td><td>0.2%</td><td>ì•½ 13%</td></tr>
                        <tr><td>4ì£¼íƒâ†‘/ë²•ì¸</td><td>-</td><td>12%</td><td>0.2%</td><td>ì•½ 13%</td></tr>
                        <tr><td>ìƒê°€Â·í† ì§€</td><td>-</td><td>4%</td><td>0.2%</td><td>4.6%</td></tr>
                        <tr><td>ì¦ì—¬(ì¼ë°˜)</td><td>-</td><td>3.5%</td><td>0.2%</td><td>ì•½ 3.85%</td></tr>
                        <tr><td>ì¦ì—¬(ì¡°ì •3ì–µâ†‘)</td><td>-</td><td>12%</td><td>0.2%</td><td>ì•½ 13%</td></tr>
                        <tr><td>ìƒì†</td><td>-</td><td>2.8%</td><td>ì—†ìŒ</td><td>ì•½ 3.08%</td></tr>
                    </table>
                    <p style="margin-top:8px; font-size:0.85em;">â€» ì§€ë°©êµìœ¡ì„¸ëŠ” ì·¨ë“ì„¸ì˜ 10% &nbsp;â€» ì‹¤ì œ ì„¸ì•¡ì€ ì „ë¬¸ê°€ í™•ì¸ í•„ìš”</p>
                </div>
            </div>
        </div>

        <!-- ===== ì¤‘ê°œìˆ˜ìˆ˜ë£Œ ê³„ì‚°ê¸° ===== -->
        <div class="calculator" id="calc-4">
            <h2>ì¤‘ê°œìˆ˜ìˆ˜ë£Œ ê³„ì‚°ê¸°</h2>
            <p>ë¶€ë™ì‚° ê±°ë˜ ìœ í˜•ë³„ ì¤‘ê°œë³´ìˆ˜ ìƒí•œìš”ìœ¨ì„ ê³„ì‚°í•©ë‹ˆë‹¤</p>

            <div class="input-group">
                <label for="brokeragePropertyType">ë¶€ë™ì‚° ìœ í˜•</label>
                <select id="brokeragePropertyType" onchange="updateBrokerageInfo()">
                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                    <option value="house">ì£¼íƒ</option>
                    <option value="officetel">ì˜¤í”¼ìŠ¤í…”</option>
                    <option value="commercial">ìƒê°€Â·ì í¬</option>
                    <option value="land">í† ì§€</option>
                </select>
                <small id="brokerageInfo">ìœ í˜•ë³„ ìƒí•œìš”ìœ¨ì´ ë‹¤ë¦…ë‹ˆë‹¤</small>
            </div>

            <div class="input-group">
                <label for="transactionType">ê±°ë˜ ìœ í˜•</label>
                <select id="transactionType" onchange="toggleRentFields()">
                    <option value="sale">ë§¤ë§¤</option>
                    <option value="rent">ì„ëŒ€ì°¨</option>
                </select>
                <small>ë§¤ë§¤/ì„ëŒ€ì°¨ì— ë”°ë¼ ìš”ìœ¨ ìƒì´</small>
            </div>

            <div class="input-group" id="saleAmountGroup">
                <label for="transactionAmount">ê±°ë˜ê¸ˆì•¡ (ì›)</label>
                <input type="text" inputmode="numeric" id="transactionAmount" placeholder="ë§¤ë§¤ê°€ ì…ë ¥" oninput="fmtInput(this); showPreview(this, 'transactionAmount-preview')">
                <div class="amount-preview" id="transactionAmount-preview"></div>
            </div>

            <div class="input-group" id="rentDepositGroup" style="display:none;">
                <label for="rentDeposit">ë³´ì¦ê¸ˆ (ì›)</label>
                <input type="text" inputmode="numeric" id="rentDeposit" placeholder="ì„ëŒ€ì°¨ ë³´ì¦ê¸ˆ" oninput="fmtInput(this); showPreview(this, 'rentDeposit-preview')">
                <div class="amount-preview" id="rentDeposit-preview"></div>
            </div>

            <div class="input-group" id="monthlyRentGroup" style="display:none;">
                <label for="monthlyRent">ì›”ì„¸ (ì›)</label>
                <input type="text" inputmode="numeric" id="monthlyRent" placeholder="ì›”ì„¸" oninput="fmtInput(this); showPreview(this, 'monthlyRent-preview')">
                <div class="amount-preview" id="monthlyRent-preview"></div>
                <small>ì›”ì„¸ Ã— 100ìœ¼ë¡œ í™˜ì‚°í•˜ì—¬ ê³„ì‚°ë©ë‹ˆë‹¤</small>
            </div>

            <div class="button-group">
                <button class="btn-primary" onclick="calculateBrokerage()">ê³„ì‚°í•˜ê¸°</button>
                <button class="btn-secondary" onclick="resetBrokerage()">ì´ˆê¸°í™”</button>
            </div>

            <div class="result" id="brokerageResult">
                <div class="result-item">
                    <span class="result-label">í™˜ì‚° ê±°ë˜ê¸ˆì•¡</span>
                    <span class="result-value" id="convertedAmount">0ì›</span>
                </div>
                <div class="result-item">
                    <span class="result-label">ì ìš© ìš”ìœ¨</span>
                    <span class="result-value" id="appliedRate">0%</span>
                </div>
                <div class="result-item highlight">
                    <span class="result-label">ì¤‘ê°œë³´ìˆ˜ ìƒí•œì•¡</span>
                    <span class="result-value" id="brokerageFee">0ì›</span>
                </div>
                <div class="result-item">
                    <span class="result-label">ë¶€ê°€ì„¸ (VAT 10%)</span>
                    <span class="result-value" id="brokerageVat">0ì›</span>
                </div>
                <div class="result-item" style="background:#f0f4ff;">
                    <span class="result-label" style="color:#333; font-weight:700;">ë¶€ê°€ì„¸ í¬í•¨ í•©ê³„</span>
                    <span class="result-value" id="brokerageFeeTotal">0ì›</span>
                </div>
                <div class="result-explanation" id="brokerageExplanation"></div>
                <div class="notice">
                    <strong>ğŸ’¡ ì¤‘ê°œìˆ˜ìˆ˜ë£Œ ê³„ì‚° ë°©ë²•</strong>
                    <p style="margin:8px 0 5px 0;">
                        <strong>ë§¤ë§¤:</strong> ê±°ë˜ê¸ˆì•¡ Ã— ìš”ìœ¨<br>
                        <strong>ì„ëŒ€ì°¨:</strong> (ë³´ì¦ê¸ˆ + ì›”ì„¸ Ã— 100) Ã— ìš”ìœ¨<br>
                        <small style="color:#666;">â€» ì›”ì„¸ëŠ” 100ë°° í™˜ì‚° í›„ ë³´ì¦ê¸ˆì— í•©ì‚°</small>
                    </p>
                    <p style="margin:8px 0 5px 0;">
                        <strong>ë¶€ê°€ì„¸(VAT):</strong> ê°œì—…ê³µì¸ì¤‘ê°œì‚¬ëŠ” ë¶€ê°€ê°€ì¹˜ì„¸ë²•ì— ë”°ë¼ ì¤‘ê°œë³´ìˆ˜ì— 10% VATë¥¼ ë³„ë„ ìˆ˜ë ¹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì‹¤ì œ ì§€ë¶ˆ ê¸ˆì•¡ = ì¤‘ê°œë³´ìˆ˜ + VAT
                    </p>
                    <p style="margin:10px 0 0 0; padding-top:10px; border-top:1px solid #ddd;">
                        <strong>ì£¼íƒ/ì˜¤í”¼ìŠ¤í…” ê±°ë˜ê¸ˆì•¡ë³„ ìƒí•œìš”ìœ¨:</strong><br>
                        â€¢ 5ì²œë§Œì› ë¯¸ë§Œ: 0.6% &nbsp;â€¢ 5ì²œë§Œ~2ì–µ ë¯¸ë§Œ: 0.5%<br>
                        â€¢ 2ì–µ~6ì–µ ë¯¸ë§Œ: 0.4% &nbsp;â€¢ 6ì–µ~9ì–µ ë¯¸ë§Œ: 0.5%<br>
                        â€¢ 9ì–µ~12ì–µ ë¯¸ë§Œ: 0.6% &nbsp;â€¢ 12ì–µ~15ì–µ ë¯¸ë§Œ: 0.7%<br>
                        â€¢ 15ì–µ ì´ìƒ: 0.9%
                    </p>
                    <p style="margin:10px 0 0 0; padding-top:10px; border-top:1px solid #ddd;">
                        <strong>ìƒê°€Â·ì í¬/í† ì§€:</strong> ê±°ë˜ê¸ˆì•¡ì˜ 0.9% í•œë„ ë‚´ í˜‘ì˜<br>
                        â€» ìƒí•œìš”ìœ¨ì€ ìŒë°© í•©ì‚° ê¸°ì¤€ì…ë‹ˆë‹¤.
                    </p>
                </div>
            </div>
        </div>

        <!-- ===== ì ì • ì›”ì„¸ ê³„ì‚°ê¸° ===== -->
        <div class="calculator" id="calc-5">
            <h2>ì ì • ì›”ì„¸</h2>
            <p>ë§¤ë§¤ê°€, ë³´ì¦ê¸ˆ, ìˆ˜ìµë¥  ê¸°ë°˜ ì ì • ì›”ì„¸ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.</p>

            <div style="background:#e3f2fd; padding:15px; border-radius:8px; margin-bottom:25px;">
                <strong style="color:#1976d2;">ğŸ“Œ ê³„ì‚° ê³µì‹</strong>
                <p style="color:#1565c0; margin-top:8px; margin-bottom:0;">ì ì • ì›”ì„¸ = ëª©í‘œìˆ˜ìµë¥  Ã— (ë§¤ë§¤ê°€ - ë³´ì¦ê¸ˆ) Ã· 12</p>
            </div>

            <div class="input-group">
                <label for="propertyPrice">ë§¤ë§¤ê°€ (ì›)</label>
                <input type="text" inputmode="numeric" id="propertyPrice" placeholder="ì˜ˆ: 300,000,000" oninput="fmtInput(this); showPreview(this, 'propertyPrice-preview')">
                <div class="amount-preview" id="propertyPrice-preview"></div>
            </div>

            <div class="input-group">
                <label for="rentDeposit2">ë³´ì¦ê¸ˆ (ì›)</label>
                <input type="text" inputmode="numeric" id="rentDeposit2" placeholder="ì˜ˆ: 50,000,000" oninput="fmtInput(this); showPreview(this, 'rentDeposit2-preview')">
                <div class="amount-preview" id="rentDeposit2-preview"></div>
            </div>

            <div class="input-group">
                <label for="targetYield">ìˆ˜ìµë¥  (%)</label>
                <input type="text" inputmode="decimal" id="targetYield" value="5">
            </div>

            <div class="input-group">
                <label for="yieldType">ì¢…ë³„ ìˆ˜ìµë¥  ì ìš©</label>
                <select id="yieldType" onchange="updateYieldRate()">
                    <option value="custom">ì§ì ‘ ì…ë ¥</option>
                    <option value="type1">1ì¢… (5%)</option>
                    <option value="type2">2ì¢… (6%)</option>
                    <option value="type3">3ì¢… (7%)</option>
                </select>
            </div>

            <div class="button-group">
                <button class="btn-primary" onclick="calculateProperRent()">ê³„ì‚°í•˜ê¸°</button>
                <button class="btn-secondary" onclick="resetProperRent()">ì´ˆê¸°í™”</button>
            </div>

            <div class="result" id="properRentResult">
                <div class="result-item">
                    <span class="result-label">ë§¤ë§¤ê°€</span>
                    <span class="result-value" id="properRentPriceDisplay">0ì›</span>
                </div>
                <div class="result-item">
                    <span class="result-label">ë³´ì¦ê¸ˆ</span>
                    <span class="result-value" id="properRentDepositDisplay">0ì›</span>
                </div>
                <div class="result-item">
                    <span class="result-label">ì‹¤íˆ¬ìê¸ˆ (ë§¤ë§¤ê°€ - ë³´ì¦ê¸ˆ)</span>
                    <span class="result-value" id="properRentBaseDisplay">0ì›</span>
                </div>
                <div class="result-item highlight">
                    <span class="result-label">ì ì • ì›”ì„¸</span>
                    <span class="result-value" id="properRent">0ì›</span>
                </div>
                <div class="result-explanation" id="properRentExplanation"></div>
            </div>
        </div>

        <!-- ===== ì ì • ë§¤ë§¤ê°€ ê³„ì‚°ê¸° ===== -->
        <div class="calculator" id="calc-6">
            <h2>ì ì • ë§¤ë§¤ê°€</h2>
            <p>ì„ëŒ€ë³´ì¦ê¸ˆ, ì›”ì„¸, ìˆ˜ìµë¥  ê¸°ë°˜ ì ì • ë§¤ë§¤ê°€ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤.</p>

            <div style="background:#e3f2fd; padding:15px; border-radius:8px; margin-bottom:25px;">
                <strong style="color:#1976d2;">ğŸ“Œ ê³„ì‚° ê³µì‹</strong>
                <p style="color:#1565c0; margin-top:8px; margin-bottom:0;">ì ì • ë§¤ë§¤ê°€ = (ì—°ìˆ˜ìµ Ã· ìˆ˜ìµë¥ ) + ë³´ì¦ê¸ˆ</p>
            </div>

            <div class="input-group">
                <label for="saleDeposit">ë³´ì¦ê¸ˆ (ì›)</label>
                <input type="text" inputmode="numeric" id="saleDeposit" placeholder="ì˜ˆ: 50,000,000" oninput="fmtInput(this); showPreview(this, 'saleDeposit-preview')">
                <div class="amount-preview" id="saleDeposit-preview"></div>
            </div>

            <div class="input-group">
                <label for="saleMonthlyRent">ì›”ì„¸ (ì›)</label>
                <input type="text" inputmode="numeric" id="saleMonthlyRent" placeholder="ì˜ˆ: 1,500,000" oninput="fmtInput(this); showPreview(this, 'saleMonthlyRent-preview')">
                <div class="amount-preview" id="saleMonthlyRent-preview"></div>
            </div>

            <div class="input-group">
                <label for="saleYield">ìˆ˜ìµë¥  (%)</label>
                <input type="text" inputmode="decimal" id="saleYield" value="5">
            </div>

            <div class="input-group">
                <label for="saleYieldType">ì¢…ë³„ ìˆ˜ìµë¥  ì ìš©</label>
                <select id="saleYieldType" onchange="updateSaleYieldRate()">
                    <option value="custom">ì§ì ‘ ì…ë ¥</option>
                    <option value="type1">1ì¢… (5%)</option>
                    <option value="type2">2ì¢… (6%)</option>
                    <option value="type3">3ì¢… (7%)</option>
                </select>
            </div>

            <div class="button-group">
                <button class="btn-primary" onclick="calculateProperPrice()">ê³„ì‚°í•˜ê¸°</button>
                <button class="btn-secondary" onclick="resetProperPrice()">ì´ˆê¸°í™”</button>
            </div>

            <div class="result" id="properPriceResult">
                <div class="result-item">
                    <span class="result-label">ì›”ì„¸</span>
                    <span class="result-value" id="properPriceRentDisplay">0ì›</span>
                </div>
                <div class="result-item">
                    <span class="result-label">ì—°ê°„ ì„ëŒ€ìˆ˜ìµ</span>
                    <span class="result-value" id="properPriceAnnualDisplay">0ì›</span>
                </div>
                <div class="result-item">
                    <span class="result-label">ë³´ì¦ê¸ˆ</span>
                    <span class="result-value" id="properPriceDepositDisplay">0ì›</span>
                </div>
                <div class="result-item highlight">
                    <span class="result-label">ì ì • ë§¤ë§¤ê°€</span>
                    <span class="result-value" id="properPrice">0ì›</span>
                </div>
                <div class="result-explanation" id="properPriceExplanation"></div>
            </div>
        </div>

        <!-- ===== í‰ë‹¹ê°€ ê³„ì‚°ê¸° ===== -->
        <div class="calculator" id="calc-7">
            <h2>í‰ë‹¹ê°€ ê³„ì‚°</h2>
            <p>ì „ìš©/ê³„ì•½ ë° ã¡/í‰ ê¸°ì¤€ìœ¼ë¡œ ë‹¨ìˆœ/í™˜ì‚° í‰ë‹¹ê°€ë¥¼ ê³„ì‚°í•˜ê³ , ëª©í‘œ í‰ë‹¹ê°€ ê¸°ì¤€ ì›”ì„¸ ì—­ì‚°ë„ ì§€ì›í•©ë‹ˆë‹¤.</p>

            <!-- ëª¨ë“œ í† ê¸€ -->
            <div class="input-group">
                <label>ê³„ì‚° ëª¨ë“œ</label>
                <div class="btn-select-group" id="ppModeGroup">
                    <button class="sel-btn active" onclick="setPPMode('forward', this)">ğŸ’° ê¸ˆì•¡ â†’ í‰ë‹¹ê°€</button>
                    <button class="sel-btn" onclick="setPPMode('reverse', this)">ğŸ”„ í‰ë‹¹ê°€ â†’ ì›”ì„¸ ì—­ì‚°</button>
                </div>
            </div>

            <!-- ë©´ì  ê¸°ì¤€ í† ê¸€ -->
            <div class="input-group">
                <label>ë©´ì  ê¸°ì¤€</label>
                <div class="btn-select-group" id="ppAreaBasisGroup">
                    <button class="sel-btn active" onclick="setPPAreaBasis('exclusive', this)">ì „ìš©ë©´ì  ê¸°ì¤€</button>
                    <button class="sel-btn" onclick="setPPAreaBasis('contract', this)">ê³„ì•½ë©´ì  ê¸°ì¤€</button>
                </div>
            </div>

            <!-- ë©´ì  ë‹¨ìœ„ í† ê¸€ -->
            <div class="input-group">
                <label>ë©´ì  ë‹¨ìœ„</label>
                <div class="btn-select-group" id="ppAreaUnitGroup">
                    <button class="sel-btn active" onclick="setPPAreaUnit('sqm', this)">ã¡ ì…ë ¥</button>
                    <button class="sel-btn" onclick="setPPAreaUnit('pyeong', this)">í‰ ì…ë ¥</button>
                </div>
            </div>

            <!-- ë©´ì  ì…ë ¥ -->
            <div class="input-group">
                <label id="ppAreaLabel">ë©´ì  (ã¡)</label>
                <input type="text" inputmode="decimal" id="ppArea" placeholder="ë©´ì ì„ ì…ë ¥í•˜ì„¸ìš”" oninput="updatePerPyeongCalc()">
                <div class="amount-preview" id="ppAreaPreview" style="color:#5c6bc0; font-weight:600;"></div>
            </div>

            <!-- ëª¨ë“œ A: ê¸ˆì•¡ â†’ í‰ë‹¹ê°€ -->
            <div id="ppForwardSection">
                <div class="input-group">
                    <label for="ppDeposit">ë³´ì¦ê¸ˆ (ì›)</label>
                    <input type="text" inputmode="numeric" id="ppDeposit" placeholder="ë³´ì¦ê¸ˆ (ì—†ìœ¼ë©´ 0)" oninput="fmtInput(this); showPreview(this, 'ppDeposit-preview'); updatePerPyeongCalc()">
                    <div class="amount-preview" id="ppDeposit-preview"></div>
                </div>
                <div class="input-group">
                    <label for="ppRent">ì›”ì„¸ (ì›)</label>
                    <input type="text" inputmode="numeric" id="ppRent" placeholder="ì›”ì„¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" oninput="fmtInput(this); showPreview(this, 'ppRent-preview'); updatePerPyeongCalc()">
                    <div class="amount-preview" id="ppRent-preview"></div>
                </div>
            </div>

            <!-- ëª¨ë“œ B: í‰ë‹¹ê°€ â†’ ì—­ì‚° -->
            <div id="ppReverseSection" style="display:none;">
                <div class="input-group">
                    <label for="ppTargetRate">ëª©í‘œ í‰ë‹¹ê°€ (ì›/í‰)</label>
                    <input type="text" inputmode="numeric" id="ppTargetRate" placeholder="ì˜ˆ: 100,000" oninput="fmtInput(this); showPreview(this, 'ppTargetRate-preview'); updatePerPyeongCalc()">
                    <div class="amount-preview" id="ppTargetRate-preview"></div>
                </div>
                <div class="input-group">
                    <label for="ppReverseDeposit">ë³´ì¦ê¸ˆ (ì›)</label>
                    <input type="text" inputmode="numeric" id="ppReverseDeposit" placeholder="ë³´ì¦ê¸ˆ (ì—†ìœ¼ë©´ 0)" oninput="fmtInput(this); showPreview(this, 'ppReverseDeposit-preview'); updatePerPyeongCalc()">
                    <div class="amount-preview" id="ppReverseDeposit-preview"></div>
                </div>
            </div>

            <!-- ê³µí†µ: í™˜ì‚°ì´ìœ¨ + ë¶€ê°€ì„¸ -->
            <div class="input-group">
                <label for="ppConvRate">í™˜ì‚°ì´ìœ¨ (%)</label>
                <input type="text" inputmode="decimal" id="ppConvRate" value="5.0" oninput="updatePerPyeongCalc()">
                <small>ë³´ì¦ê¸ˆ â†’ ì›”ì„¸ í™˜ì‚° ê¸°ì¤€ìœ¨</small>
            </div>
            <div class="input-group" style="display:flex; align-items:center; gap:10px;">
                <input type="checkbox" id="ppVat" onchange="updatePerPyeongCalc()" style="width:18px; height:18px; cursor:pointer;">
                <label for="ppVat" style="margin:0; cursor:pointer; font-weight:600;">ì„ëŒ€ë£Œ ë¶€ê°€ì„¸ ë³„ë„ (VAT 10%)</label>
            </div>

            <div class="button-group">
                <button class="btn-primary" onclick="updatePerPyeongCalc()">ê³„ì‚°í•˜ê¸°</button>
                <button class="btn-secondary" onclick="resetPerPyeong()">ì´ˆê¸°í™”</button>
            </div>

            <!-- ê²°ê³¼ -->
            <div class="result" id="ppResult">
                <!-- ë±ƒì§€ -->
                <div style="text-align:center; margin-bottom:15px;">
                    <span id="ppBadge" style="display:inline-block; background:linear-gradient(135deg,#667eea,#764ba2); color:white; padding:8px 24px; border-radius:20px; font-size:1.05em; font-weight:700;"></span>
                </div>

                <!-- ëª¨ë“œA ê²°ê³¼ -->
                <div id="ppForwardResult">
                    <div class="result-item">
                        <span class="result-label">ë©´ì  (í‰/ã¡)</span>
                        <span class="result-value" id="ppAreaResult">-</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">ë³´ì¦ê¸ˆ í™˜ì‚°ì›”ì„¸</span>
                        <span class="result-value" id="ppConvertedRent">-</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label" id="ppSimpleLabel">ë‹¨ìˆœ ì›”í‰ë‹¹ê°€ (ë³„ë„)</span>
                        <span class="result-value" id="ppSimpleResult">-</span>
                    </div>
                    <div class="result-item highlight">
                        <span class="result-label" id="ppConvLabel">í™˜ì‚° ì›”í‰ë‹¹ê°€ (ë³„ë„)</span>
                        <span class="result-value" id="ppConvResult">-</span>
                    </div>
                    <div id="ppVatResult" style="display:none;">
                        <div class="result-item">
                            <span class="result-label">ë‹¨ìˆœ ì›”í‰ë‹¹ê°€ (VAT í¬í•¨)</span>
                            <span class="result-value" id="ppSimpleVatResult">-</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">í™˜ì‚° ì›”í‰ë‹¹ê°€ (VAT í¬í•¨)</span>
                            <span class="result-value" id="ppConvVatResult">-</span>
                        </div>
                    </div>
                </div>

                <!-- ëª¨ë“œB ê²°ê³¼ -->
                <div id="ppReverseResult" style="display:none;">
                    <div class="result-item">
                        <span class="result-label">ë©´ì  (í‰/ã¡)</span>
                        <span class="result-value" id="ppRevAreaResult">-</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">ë³´ì¦ê¸ˆ í™˜ì‚°ì›”ì„¸</span>
                        <span class="result-value" id="ppRevConvertedRent">-</span>
                    </div>
                    <div class="result-item">
                        <span class="result-label">ëª©í‘œ ì´ ì›”ì„ëŒ€ë£Œ</span>
                        <span class="result-value" id="ppRevTargetTotal">-</span>
                    </div>
                    <div class="result-item highlight">
                        <span class="result-label">ê¶Œì¥ ì›”ì„¸ (ë³„ë„)</span>
                        <span class="result-value" id="ppRevRent">-</span>
                    </div>
                    <div id="ppRevVatRow" style="display:none;">
                        <div class="result-item">
                            <span class="result-label">ê¶Œì¥ ì›”ì„¸ (VAT í¬í•¨)</span>
                            <span class="result-value" id="ppRevRentVat">-</span>
                        </div>
                    </div>
                    <div class="result-item">
                        <span class="result-label">ê²€ì¦ í‰ë‹¹ê°€</span>
                        <span class="result-value" id="ppRevCheck">-</span>
                    </div>
                </div>

                <div class="result-explanation" id="ppExplanation"></div>
            </div>
        </div>
    </div>

    <footer>
        <p><strong>í•˜ì´íƒ‘ë¶€ë™ì‚°</strong> Â· <a href="tel:031-949-8969">031-949-8969</a></p>
    </footer>
</div>

<script>
    // ========== ê³µí†µ ìœ í‹¸ ==========
    function fmtInput(input) {
        let v = input.value.replace(/,/g, '').replace(/[^\d]/g, '');
        if (v === '') { input.value = ''; return; }
        input.value = Number(v).toLocaleString();
    }

    function getVal(id) {
        const el = document.getElementById(id);
        if (!el) return 0;
        return parseFloat(el.value.replace(/,/g, '')) || 0;
    }

    function fmt(n) {
        return Math.round(n).toLocaleString() + 'ì›';
    }

    function koreanAmount(n) {
        if (!n || n === 0) return '';
        const units = ['', 'ë§Œ', 'ì–µ', 'ì¡°'];
        let result = '';
        const man = Math.floor(n / 10000);
        const remain = n % 10000;
        const eok = Math.floor(man / 10000);
        const manRem = man % 10000;
        if (eok > 0) result += eok.toLocaleString() + 'ì–µ ';
        if (manRem > 0) result += manRem.toLocaleString() + 'ë§Œ ';
        if (remain > 0) result += remain.toLocaleString();
        return result.trim() + 'ì›';
    }

    function showPreview(input, previewId) {
        const v = parseFloat(input.value.replace(/,/g, '')) || 0;
        const el = document.getElementById(previewId);
        if (!el) return;
        if (v > 0) {
            el.textContent = 'â†’ ' + koreanAmount(v);
            el.classList.add('show');
        } else {
            el.classList.remove('show');
        }
    }

    function switchTab(index) {
        document.querySelectorAll('.tab').forEach((t, i) => {
            t.classList.toggle('active', i === index);
        });
        document.querySelectorAll('.calculator').forEach((c, i) => {
            c.classList.toggle('active', i === index);
        });
    }

    // ========== ìƒê°€ ìˆ˜ìµë¥  ==========
    function toggleLoan() {
        const on = document.getElementById('includeLoan').checked;
        document.getElementById('loanSection').classList.toggle('show', on);
        if (!on) {
            document.getElementById('loanAmount').value = '';
            document.getElementById('loanRate').value = '';
        }
    }

    function calculateYield() {
        const price = getVal('price');
        const rent = getVal('rent');
        const deposit = getVal('deposit');
        const includeLoan = document.getElementById('includeLoan').checked;
        const loanAmount = getVal('loanAmount');
        const loanRate = getVal('loanRate');

        if (price === 0 || rent === 0) { alert('ë§¤ë§¤ê°€ì™€ ì›” ì„ëŒ€ë£Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }

        const tax = price * 0.046;
        const annualRent = rent * 12;
        let actualInvestment = includeLoan && loanAmount > 0
            ? price - loanAmount - deposit
            : price - deposit;
        let annualLoanInterest = 0;
        if (includeLoan && loanAmount > 0 && loanRate > 0) {
            annualLoanInterest = loanAmount * (loanRate / 100);
        }
        const netIncome = annualRent - annualLoanInterest;
        const yieldRate = actualInvestment > 0 ? (netIncome / actualInvestment * 100) : 0;

        document.getElementById('salePriceDisplay').textContent = fmt(price);
        document.getElementById('taxDisplay').textContent = fmt(tax);
        document.getElementById('annualRent').textContent = fmt(annualRent);

        const loanRow = document.getElementById('loanInterestRow');
        if (includeLoan && loanAmount > 0) {
            loanRow.style.display = 'flex';
            document.getElementById('annualLoanInterest').textContent = fmt(annualLoanInterest);
        } else {
            loanRow.style.display = 'none';
        }

        document.getElementById('actualInvestment').textContent = fmt(actualInvestment);
        document.getElementById('yieldRate').textContent = yieldRate.toFixed(2) + '%';

        let exp = `ğŸ“Š ìˆ˜ìµë¥  ê³„ì‚° ìƒì„¸\n`;
        exp = `ë§¤ë§¤ê°€ ${koreanAmount(price)}ì—ì„œ ë³´ì¦ê¸ˆ ${koreanAmount(deposit)}ì„ ì œì™¸í•œ ì‹¤íˆ¬ìê¸ˆ ${koreanAmount(actualInvestment)}ì— ëŒ€í•´, `;
        exp += `ì—°ê°„ ì„ëŒ€ìˆ˜ìµ ${koreanAmount(annualRent)}`;
        if (includeLoan && annualLoanInterest > 0) exp += ` - ëŒ€ì¶œì´ì ${koreanAmount(annualLoanInterest)} = ìˆœìˆ˜ìµ ${koreanAmount(netIncome)}`;
        exp += `ìœ¼ë¡œ ì‹¤ì§ˆ ìˆ˜ìµë¥  <strong>${yieldRate.toFixed(2)}%</strong>ê°€ ì‚°ì¶œë˜ì—ˆìŠµë‹ˆë‹¤.`;
        if (yieldRate >= 6) exp += ` âœ… ìˆ˜ìµë¥ ì´ ì–‘í˜¸í•œ ìˆ˜ì¤€ì…ë‹ˆë‹¤.`;
        else if (yieldRate >= 4) exp += ` â„¹ï¸ í‰ê· ì ì¸ ìˆ˜ìµë¥  ìˆ˜ì¤€ì…ë‹ˆë‹¤.`;
        else exp += ` âš ï¸ ìˆ˜ìµë¥ ì´ ë‚®ì€ í¸ì´ë‹ˆ íˆ¬ì ì¡°ê±´ì„ ì¬ê²€í† í•´ë³´ì„¸ìš”.`;

        const expEl = document.getElementById('yieldExplanation');
        expEl.innerHTML = `<strong>ğŸ’¬ ê³„ì‚° ê²°ê³¼ í•´ì„¤</strong>${exp}`;
        document.getElementById('yieldResult').classList.add('show');
    }

    function resetYield() {
        ['price','rent','deposit','loanAmount','loanRate'].forEach(id => document.getElementById(id).value = '');
        document.getElementById('includeLoan').checked = false;
        document.getElementById('loanSection').classList.remove('show');
        document.getElementById('yieldResult').classList.remove('show');
        document.querySelectorAll('#calc-0 .amount-preview').forEach(el => el.classList.remove('show'));
    }

    // ========== ì„ëŒ€ë£Œ ì¸ìƒ ==========
    function calculateRentIncrease() {
        const curDep = getVal('currentDeposit');
        const curRent = getVal('currentRent');
        const newDepInput = getVal('newDeposit');
        const increaseRate = getVal('increaseRate');
        const monthlyConvRate = getVal('monthlyConvRate'); // ì›”ì°¨ì„ì „í™˜ìœ¨ (ì˜ˆ: 2%)
        const baseRate = getVal('baseRate');               // ê¸°ì¤€ê¸ˆë¦¬ (ì˜ˆ: 2.5%)

        if (curDep === 0 && curRent === 0) { alert('í˜„ì¬ ë³´ì¦ê¸ˆ ë˜ëŠ” ì›”ì„¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }

        // ë ŒíŠ¸í™ˆ ê³µì‹: í™˜ì‚°ì „í™˜ìœ¨ = ì›”ì°¨ì„ì „í™˜ìœ¨ + ê¸°ì¤€ê¸ˆë¦¬
        const convRate = monthlyConvRate + baseRate; // ì˜ˆ: 2 + 2.5 = 4.5%

        // ë³€ê²½ í›„ ë³´ì¦ê¸ˆ: ì…ë ¥ê°’ ì—†ìœ¼ë©´ í˜„ì¬ ë³´ì¦ê¸ˆ ê·¸ëŒ€ë¡œ
        const newDep = newDepInput > 0 ? newDepInput : curDep;

        // ë ŒíŠ¸í™ˆ ë°©ì‹:
        // í™˜ì‚°ë³´ì¦ê¸ˆ(ë³€ê²½ì „) = í˜„ì¬ë³´ì¦ê¸ˆ + (í˜„ì¬ì›”ì„¸ Ã— 12) / ì „í™˜ìœ¨
        const curEquivDep = curDep + (curRent * 12) / (convRate / 100);

        // 5% ì¸ìƒ í›„ ìµœëŒ€ í™˜ì‚°ë³´ì¦ê¸ˆ
        const maxEquivDep = curEquivDep * (1 + increaseRate / 100);

        // ë³€ê²½ í›„ ì›”ì„¸ = (ìµœëŒ€í™˜ì‚°ë³´ì¦ê¸ˆ - ë³€ê²½ë³´ì¦ê¸ˆ) Ã— ì „í™˜ìœ¨ / 12
        let newRent = (maxEquivDep - newDep) * (convRate / 100) / 12;
        if (newRent < 0) newRent = 0;
        newRent = Math.round(newRent);

        document.getElementById('beforeDeposit').textContent = curDep.toLocaleString();
        document.getElementById('afterDeposit').textContent = newDep.toLocaleString();
        document.getElementById('beforeRent').textContent = curRent.toLocaleString();
        document.getElementById('afterRent').textContent = newRent.toLocaleString();
        document.getElementById('beforeAnnualRent').textContent = (curRent * 12).toLocaleString();
        document.getElementById('afterAnnualRent').textContent = (newRent * 12).toLocaleString();

        const depDiff = newDep - curDep;
        let exp = `ì›”ì°¨ì„ì „í™˜ì‹œì‚°ì •ë¥  ${monthlyConvRate}% + ê¸°ì¤€ê¸ˆë¦¬ ${baseRate}% = ì ìš© ì „í™˜ìœ¨ <strong>${convRate}%</strong><br>`;
        exp += `í˜„ì¬ í™˜ì‚°ë³´ì¦ê¸ˆ: ${koreanAmount(Math.round(curEquivDep))} â†’ ${increaseRate}% ì¸ìƒ í›„ ìµœëŒ€: <strong>${koreanAmount(Math.round(maxEquivDep))}</strong><br>`;
        exp += `ë³€ê²½ ë³´ì¦ê¸ˆ ${koreanAmount(newDep)} ì°¨ê° í›„ ì›”ì„¸: <strong>${newRent.toLocaleString()}ì›</strong> (ì—° ${koreanAmount(newRent * 12)})`;

        document.getElementById('rentExplanation').innerHTML = `<strong>ğŸ’¬ ê³„ì‚° ê²°ê³¼ í•´ì„¤</strong>${exp}`;
        document.getElementById('rentResult').classList.add('show');
    }

    function resetRentIncrease() {
        ['currentDeposit','currentRent','newDeposit'].forEach(id => document.getElementById(id).value = '');
        document.getElementById('increaseRate').value = '5';
        document.getElementById('monthlyConvRate').value = '2';
        document.getElementById('baseRate').value = '2.5';
        document.getElementById('rentResult').classList.remove('show');
        document.querySelectorAll('#calc-1 .amount-preview').forEach(el => el.classList.remove('show'));
    }

    // ========== í‰ë‹¹ê°€ ê³„ì‚° ==========
    let ppState = {
        mode: 'forward',      // forward / reverse
        areaBasis: 'exclusive',
        areaUnit: 'sqm'
    };

    function setPPMode(v, btn) {
        ppState.mode = v;
        setActivBtn('ppModeGroup', btn);
        document.getElementById('ppForwardSection').style.display = v === 'forward' ? 'block' : 'none';
        document.getElementById('ppReverseSection').style.display = v === 'reverse' ? 'block' : 'none';
        document.getElementById('ppForwardResult').style.display = v === 'forward' ? 'block' : 'none';
        document.getElementById('ppReverseResult').style.display = v === 'reverse' ? 'block' : 'none';
        document.getElementById('ppResult').classList.remove('show');
        updatePerPyeongCalc();
    }

    function setPPAreaBasis(v, btn) {
        ppState.areaBasis = v;
        setActivBtn('ppAreaBasisGroup', btn);
        updatePerPyeongCalc();
    }

    function setPPAreaUnit(v, btn) {
        ppState.areaUnit = v;
        setActivBtn('ppAreaUnitGroup', btn);
        document.getElementById('ppAreaLabel').textContent = v === 'sqm' ? 'ë©´ì  (ã¡)' : 'ë©´ì  (í‰)';
        document.getElementById('ppArea').placeholder = v === 'sqm' ? 'ã¡ë¥¼ ì…ë ¥í•˜ì„¸ìš”' : 'í‰ì„ ì…ë ¥í•˜ì„¸ìš”';
        updatePerPyeongCalc();
    }

    function getPPAreaValues() {
        const raw = document.getElementById('ppArea').value.replace(/,/g,'');
        const val = parseFloat(raw);
        if (!val || val <= 0) return null;
        let sqm, pyeong;
        if (ppState.areaUnit === 'sqm') {
            sqm = val;
            pyeong = val / 3.305785;
        } else {
            pyeong = val;
            sqm = val * 3.305785;
        }
        return { sqm: Math.round(sqm*100)/100, pyeong: Math.round(pyeong*100)/100 };
    }

    function ppKorean(v) {
        if (v >= 100000000) return (Math.round(v/10000000)/10).toFixed(1) + 'ì–µì›';
        if (v >= 10000) return Math.round(v/10000) + 'ë§Œì›';
        return v.toLocaleString() + 'ì›';
    }

    function updatePerPyeongCalc() {
        const area = getPPAreaValues();
        const convRate = parseFloat(document.getElementById('ppConvRate').value) || 5;
        const vatOn = document.getElementById('ppVat').checked;

        // ë©´ì  ë¯¸ë¦¬ë³´ê¸°
        const preview = document.getElementById('ppAreaPreview');
        if (area) {
            preview.textContent = `= ${area.pyeong.toFixed(2)} í‰  /  = ${area.sqm.toFixed(2)} ã¡`;
            preview.classList.add('show');
        } else {
            preview.textContent = 'ë©´ì ì„ ì…ë ¥í•˜ì„¸ìš”';
            preview.classList.add('show');
            document.getElementById('ppResult').classList.remove('show');
            return;
        }

        if (ppState.mode === 'forward') {
            // ëª¨ë“œA: ê¸ˆì•¡ â†’ í‰ë‹¹ê°€
            const deposit = getVal('ppDeposit');
            const rent = getVal('ppRent');

            const convertedMonthly = deposit * (convRate/100) / 12;
            const totalMonthly = rent + convertedMonthly;

            // í‰ë‹¹ê°€
            const simplePP = rent / area.pyeong;
            const simplePPsqm = rent / area.sqm;
            const convPP = totalMonthly / area.pyeong;
            const convPPsqm = totalMonthly / area.sqm;

            const basisLabel = ppState.areaBasis === 'exclusive' ? 'ì „ìš©' : 'ê³„ì•½';

            document.getElementById('ppAreaResult').textContent =
                `${area.pyeong.toFixed(2)}í‰ (${basisLabel}) / ${area.sqm.toFixed(2)}ã¡`;
            document.getElementById('ppConvertedRent').textContent =
                `${Math.round(convertedMonthly).toLocaleString()}ì› (${ppKorean(Math.round(convertedMonthly))})`;
            document.getElementById('ppSimpleResult').textContent =
                `${Math.round(simplePP).toLocaleString()}ì›/í‰ | ${Math.round(simplePPsqm).toLocaleString()}ì›/ã¡`;
            document.getElementById('ppConvResult').textContent =
                `${Math.round(convPP).toLocaleString()}ì›/í‰ | ${Math.round(convPPsqm).toLocaleString()}ì›/ã¡`;

            if (vatOn) {
                document.getElementById('ppVatResult').style.display = 'block';
                document.getElementById('ppSimpleVatResult').textContent =
                    `${Math.round(simplePP*1.1).toLocaleString()}ì›/í‰ | ${Math.round(simplePPsqm*1.1).toLocaleString()}ì›/ã¡`;
                document.getElementById('ppConvVatResult').textContent =
                    `${Math.round(convPP*1.1).toLocaleString()}ì›/í‰ | ${Math.round(convPPsqm*1.1).toLocaleString()}ì›/ã¡`;
            } else {
                document.getElementById('ppVatResult').style.display = 'none';
            }

            document.getElementById('ppBadge').textContent =
                `í™˜ì‚° í‰ë‹¹ê°€ ${Math.round(convPP).toLocaleString()}ì›/í‰${vatOn?' (ë¶€ê°€ì„¸ ë³„ë„)':''}`;

            const basisText = ppState.areaBasis === 'exclusive' ? 'ì „ìš©ë©´ì ' : 'ê³„ì•½ë©´ì ';
            let exp = `${basisText} ${area.pyeong.toFixed(2)}í‰ ê¸°ì¤€, ì›”ì„¸ ${rent.toLocaleString()}ì› + ë³´ì¦ê¸ˆ í™˜ì‚° ${Math.round(convertedMonthly).toLocaleString()}ì› = ì´ ${Math.round(totalMonthly).toLocaleString()}ì›<br>`;
            exp += `ë‹¨ìˆœ í‰ë‹¹ê°€ <strong>${Math.round(simplePP).toLocaleString()}ì›/í‰</strong>, í™˜ì‚° í‰ë‹¹ê°€ <strong>${Math.round(convPP).toLocaleString()}ì›/í‰</strong>`;
            if (vatOn) exp += `<br>VAT í¬í•¨ ì‹œ í™˜ì‚° í‰ë‹¹ê°€ <strong>${Math.round(convPP*1.1).toLocaleString()}ì›/í‰</strong>`;
            document.getElementById('ppExplanation').innerHTML = `<strong>ğŸ’¬ ê³„ì‚° ê²°ê³¼ í•´ì„¤</strong>${exp}`;

        } else {
            // ëª¨ë“œB: í‰ë‹¹ê°€ â†’ ì›”ì„¸ ì—­ì‚°
            const targetPP = getVal('ppTargetRate');
            const deposit = getVal('ppReverseDeposit');

            const convertedMonthly = deposit * (convRate/100) / 12;
            const targetTotal = targetPP * area.pyeong;
            const calcRent = Math.max(0, targetTotal - convertedMonthly);
            const calcRentVat = calcRent * 1.1;

            // ê²€ì¦
            const checkPP = (calcRent + convertedMonthly) / area.pyeong;

            const basisLabel = ppState.areaBasis === 'exclusive' ? 'ì „ìš©' : 'ê³„ì•½';
            document.getElementById('ppRevAreaResult').textContent =
                `${area.pyeong.toFixed(2)}í‰ (${basisLabel}) / ${area.sqm.toFixed(2)}ã¡`;
            document.getElementById('ppRevConvertedRent').textContent =
                `${Math.round(convertedMonthly).toLocaleString()}ì› (${ppKorean(Math.round(convertedMonthly))})`;
            document.getElementById('ppRevTargetTotal').textContent =
                `${Math.round(targetTotal).toLocaleString()}ì› (${ppKorean(Math.round(targetTotal))})`;
            document.getElementById('ppRevRent').textContent =
                `${Math.round(calcRent).toLocaleString()}ì› (${ppKorean(Math.round(calcRent))})`;
            document.getElementById('ppRevCheck').textContent =
                `${Math.round(checkPP).toLocaleString()}ì›/í‰ âœ…`;

            if (vatOn) {
                document.getElementById('ppRevVatRow').style.display = 'block';
                document.getElementById('ppRevRentVat').textContent =
                    `${Math.round(calcRentVat).toLocaleString()}ì› (${ppKorean(Math.round(calcRentVat))})`;
            } else {
                document.getElementById('ppRevVatRow').style.display = 'none';
            }

            document.getElementById('ppBadge').textContent =
                `ê¶Œì¥ ì›”ì„¸ ${Math.round(calcRent).toLocaleString()}ì›${vatOn?' (ë¶€ê°€ì„¸ ë³„ë„)':''}`;

            let exp = `ëª©í‘œ í‰ë‹¹ê°€ ${targetPP.toLocaleString()}ì›/í‰ Ã— ${area.pyeong.toFixed(2)}í‰ = ì´ ${Math.round(targetTotal).toLocaleString()}ì›<br>`;
            exp += `ë³´ì¦ê¸ˆ í™˜ì‚° ${Math.round(convertedMonthly).toLocaleString()}ì› ì°¨ê° í›„ ê¶Œì¥ ì›”ì„¸ <strong>${Math.round(calcRent).toLocaleString()}ì›</strong>`;
            if (vatOn) exp += `<br>VAT í¬í•¨ ì‹œ <strong>${Math.round(calcRentVat).toLocaleString()}ì›</strong>`;
            document.getElementById('ppExplanation').innerHTML = `<strong>ğŸ’¬ ê³„ì‚° ê²°ê³¼ í•´ì„¤</strong>${exp}`;
        }

        document.getElementById('ppResult').classList.add('show');
    }

    function resetPerPyeong() {
        ['ppArea','ppDeposit','ppRent','ppTargetRate','ppReverseDeposit'].forEach(id => {
            const el = document.getElementById(id);
            if (el) el.value = '';
        });
        document.getElementById('ppConvRate').value = '5.0';
        document.getElementById('ppVat').checked = false;
        document.getElementById('ppAreaPreview').classList.remove('show');
        document.getElementById('ppResult').classList.remove('show');
        document.querySelectorAll('#calc-7 .amount-preview').forEach(el => el.classList.remove('show'));
        // ìƒíƒœ ì´ˆê¸°í™”
        ppState = { mode:'forward', areaBasis:'exclusive', areaUnit:'sqm' };
        document.getElementById('ppForwardSection').style.display = 'block';
        document.getElementById('ppReverseSection').style.display = 'none';
        document.getElementById('ppForwardResult').style.display = 'block';
        document.getElementById('ppReverseResult').style.display = 'none';
        document.getElementById('ppAreaLabel').textContent = 'ë©´ì  (ã¡)';
        ['ppModeGroup','ppAreaBasisGroup','ppAreaUnitGroup'].forEach(id => {
            const btns = document.getElementById(id).querySelectorAll('.sel-btn');
            btns.forEach((b,i) => b.classList.toggle('active', i===0));
        });
    }

    // ========== ì „ì›”ì„¸ ì „í™˜ ==========
    let convDirection = 'jeonToWol';

    function setDirection(dir) {
        convDirection = dir;
        document.getElementById('btnJeonToWol').classList.toggle('active', dir === 'jeonToWol');
        document.getElementById('btnWolToJeon').classList.toggle('active', dir === 'wolToJeon');
        document.getElementById('jeonToWolSection').style.display = dir === 'jeonToWol' ? 'block' : 'none';
        document.getElementById('wolToJeonSection').style.display = dir === 'wolToJeon' ? 'block' : 'none';
        document.getElementById('conversionResult').classList.remove('show');
    }

    function calculateConversion() {
        const rate = getVal('conversionRate2');
        if (rate === 0) { alert('ì „í™˜ìœ¨ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }

        if (convDirection === 'jeonToWol') {
            const jeonDep = getVal('jeonDeposit');
            const newWolDep = getVal('newWolDeposit');
            if (jeonDep === 0) { alert('ì „ì„¸ê¸ˆì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }

            const convertBase = jeonDep - newWolDep;
            const monthlyRent = convertBase * (rate / 100) / 12;

            document.getElementById('convResult1Label').textContent = 'ì „ì„¸ê¸ˆ';
            document.getElementById('convResult1Value').textContent = fmt(jeonDep);
            document.getElementById('convResult2Label').textContent = 'ë³€ê²½ ë³´ì¦ê¸ˆ';
            document.getElementById('convResult2Value').textContent = fmt(newWolDep);
            document.getElementById('convResult3Label').textContent = 'ì „í™˜ ê¸°ì¤€ê¸ˆì•¡ (ì „ì„¸ê¸ˆ - ë³´ì¦ê¸ˆ)';
            document.getElementById('convResult3Value').textContent = fmt(convertBase);
            document.getElementById('convResultMainLabel').textContent = 'ì›”ì„¸';
            document.getElementById('convResultMain').textContent = fmt(monthlyRent);

            const exp = `ì „ì„¸ê¸ˆ ${koreanAmount(jeonDep)}ì—ì„œ ë³´ì¦ê¸ˆ ${koreanAmount(newWolDep)}ì„ ì œì™¸í•œ <strong>${koreanAmount(convertBase)}</strong>ì— ì „í™˜ìœ¨ ${rate}%ë¥¼ ì ìš©í•˜ë©´, ì›”ì„¸ëŠ” <strong>${fmt(monthlyRent)}</strong>ì…ë‹ˆë‹¤. (${koreanAmount(convertBase)} Ã— ${rate}% Ã· 12ê°œì›”)`;
            document.getElementById('convExplanation').innerHTML = `<strong>ğŸ’¬ ê³„ì‚° ê²°ê³¼ í•´ì„¤</strong>${exp}`;

        } else {
            const wolDep = getVal('wolDeposit');
            const wolRent = getVal('wolRent');
            if (wolRent === 0) { alert('ì›”ì„¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }

            const jeonTotal = wolDep + (wolRent * 12 / (rate / 100));

            document.getElementById('convResult1Label').textContent = 'í˜„ì¬ ë³´ì¦ê¸ˆ';
            document.getElementById('convResult1Value').textContent = fmt(wolDep);
            document.getElementById('convResult2Label').textContent = 'í˜„ì¬ ì›”ì„¸';
            document.getElementById('convResult2Value').textContent = fmt(wolRent);
            document.getElementById('convResult3Label').textContent = 'ì›”ì„¸ ì „í™˜ê¸ˆì•¡ (ì›”ì„¸ Ã— 12 Ã· ì „í™˜ìœ¨)';
            document.getElementById('convResult3Value').textContent = fmt(wolRent * 12 / (rate / 100));
            document.getElementById('convResultMainLabel').textContent = 'ì „ì„¸ ì „í™˜ê¸ˆì•¡';
            document.getElementById('convResultMain').textContent = fmt(jeonTotal);

            const exp = `ì›”ì„¸ ${koreanAmount(wolRent)}ì— ì „í™˜ìœ¨ ${rate}%ë¥¼ ì ìš©í•˜ë©´, ë³´ì¦ê¸ˆ ${koreanAmount(wolDep)} + ì „í™˜ê¸ˆì•¡ ${koreanAmount(Math.round(wolRent * 12 / (rate / 100)))} = <strong>ì „ì„¸ ${fmt(jeonTotal)}</strong>ë¡œ ì „í™˜ë©ë‹ˆë‹¤.`;
            document.getElementById('convExplanation').innerHTML = `<strong>ğŸ’¬ ê³„ì‚° ê²°ê³¼ í•´ì„¤</strong>${exp}`;
        }

        document.getElementById('conversionResult').classList.add('show');
    }

    function resetConversion() {
        ['jeonDeposit','newWolDeposit','wolDeposit','wolRent'].forEach(id => document.getElementById(id).value = '');
        document.getElementById('conversionRate2').value = '5.0';
        document.getElementById('conversionResult').classList.remove('show');
        document.querySelectorAll('#calc-2 .amount-preview').forEach(el => el.classList.remove('show'));
    }

    // ========== ì·¨ë“ì„¸ ==========
    let taxState = {
        acqType: 'buy',       // buy / gift / inherit
        assetType: 'house',   // house / officetel / commercial / farmland
        isCorp: false,
        houseCount: 1,
        isAdjusted: false,
        isOver85: false,
        officetelUse: 'business',  // business / residential
        farmlandType: 'general'    // general / selfcult / agcorp_new / agcorp
    };

    function setAcqType(v, btn) {
        taxState.acqType = v;
        setActivBtn('acqTypeGroup', btn);
        const showHouse = (v === 'buy');
        document.getElementById('assetTypeGroup').style.display = showHouse ? 'block' : 'none';
        document.getElementById('houseOptions').style.display = (v === 'buy' && taxState.assetType === 'house') ? 'block' : 'none';
        document.getElementById('officetelUseGroup').style.display = 'none';
    }

    function setAssetType(v, btn) {
        taxState.assetType = v;
        setActivBtn('assetBtnGroup', btn);
        document.getElementById('houseOptions').style.display = (v === 'house') ? 'block' : 'none';
        document.getElementById('officetelUseGroup').style.display = (v === 'officetel') ? 'block' : 'none';
        document.getElementById('farmlandGroup').style.display = (v === 'farmland') ? 'block' : 'none';
    }

    function setFarmlandType(v, btn) {
        taxState.farmlandType = v;
        setActivBtn('farmlandTypeBtnGroup', btn);
        const notes = {
            general: 'ì¼ë°˜ë†ì§€: ì·¨ë“ì„¸ 3% + ì§€ë°©êµìœ¡ì„¸ 0.3% + ë†íŠ¹ì„¸ 0.2% = ì´ 3.5%',
            selfcult: 'ìê²½ë†ì§€(2ë…„â†‘): ì·¨ë“ì„¸ 1.5% + ì§€ë°©êµìœ¡ì„¸ 0.1% = ì´ 1.6% (ë†íŠ¹ì„¸ ì—†ìŒ)',
            agcorp_new: 'ë†ì—…ë²•ì¸(ì„¤ë¦½ 2ë…„ë‚´): ì·¨ë“ì„¸ 75% ê²½ê° â†’ 0.75% (2026ë…„ 12ì›” 31ì¼ê¹Œì§€)',
            agcorp: 'ë†ì—…ë²•ì¸(ì˜ë†Â·ìœ í†µÂ·ê°€ê³µ): ì·¨ë“ì„¸ 50% ê²½ê° â†’ 1.5% (2026ë…„ 12ì›” 31ì¼ê¹Œì§€)'
        };
        document.getElementById('farmlandNote').textContent = notes[v];
    }

    function setCorp(v, btn) {
        taxState.isCorp = v;
        setActivBtn('corpGroup', btn);
        document.getElementById('houseCountGroup').style.display = v ? 'none' : 'block';
        document.getElementById('adjustedAreaGroup2').style.display = v ? 'none' : 'block';
    }

    function setHouseCount(v, btn) {
        taxState.houseCount = v;
        setActivBtn('houseCountBtnGroup', btn);
    }

    function setAdjArea(v, btn) {
        taxState.isAdjusted = v;
        setActivBtn('adjAreaBtnGroup', btn);
    }

    function setArea(v, btn) {
        taxState.isOver85 = v;
        setActivBtn('areaBtnGroup', btn);
    }

    function setOfficetelUse(v, btn) {
        taxState.officetelUse = v;
        setActivBtn('officetelUseBtnGroup', btn);
        document.getElementById('houseOptions').style.display = (v === 'residential') ? 'block' : 'none';
    }

    function setActivBtn(groupId, btn) {
        document.getElementById(groupId).querySelectorAll('.sel-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }

    function calcHouseTaxRate(price, houseCount, isAdjusted, isCorp) {
        // ë²•ì¸ì€ ë¬´ì¡°ê±´ 12%
        if (isCorp) return { rate: 0.12, label: '12% (ë²•ì¸)' };

        if (houseCount === 1 || (houseCount === 2 && !isAdjusted)) {
            // 1ì£¼íƒ or 2ì£¼íƒ ë¹„ì¡°ì • â†’ ê°€ê²© êµ¬ê°„ë³„
            if (price <= 600000000) return { rate: 0.01, label: '1%' };
            if (price <= 900000000) {
                // ì§€ë°©ì„¸ë²• ê³µì‹: ì„¸ìœ¨(%) = ì·¨ë“ê°€ì•¡ Ã— 2 / 3ì–µ - 3
                // ì†Œìˆ˜ì  2ìë¦¬ ë°˜ì˜¬ë¦¼ í›„ ì ìš© (ë¶€ë™ì‚°ê³„ì‚°ê¸°.com ë™ì¼)
                const ratePct = Math.round((price * 2 / 300000000 - 3) * 100) / 100;
                const rate = ratePct / 100;
                return { rate, label: `${ratePct.toFixed(2)}% (ëˆ„ì§„)` };
            }
            return { rate: 0.03, label: '3%' };
        }
        if (houseCount === 2 && isAdjusted) return { rate: 0.08, label: '8% (2ì£¼íƒÂ·ì¡°ì •)' };
        if (houseCount === 3 && !isAdjusted) return { rate: 0.08, label: '8% (3ì£¼íƒÂ·ì¼ë°˜)' };
        if (houseCount === 3 && isAdjusted)  return { rate: 0.12, label: '12% (3ì£¼íƒÂ·ì¡°ì •)' };
        return { rate: 0.12, label: '12% (4ì£¼íƒâ†‘)' };
    }

    function calculateAcquisitionTax() {
        const price = getVal('acquisitionPrice');
        if (price === 0) { alert('ì·¨ë“ê°€ì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }

        const { acqType, assetType, isCorp, houseCount, isAdjusted, isOver85, officetelUse } = taxState;

        let acqTaxRate = 0, eduRate = 0.1, ruralRate = 0;
        let taxLabel = '', rateLabel = '';

        if (acqType === 'inherit') {
            // ìƒì†
            acqTaxRate = 0.028; eduRate = 0.1; ruralRate = 0;
            taxLabel = 'ì·¨ë“ì„¸ 2.8% (ìƒì†)'; rateLabel = 'ìƒì† 2.8%';
        } else if (acqType === 'gift') {
            // ì¦ì—¬
            if (assetType === 'house' && isAdjusted && price >= 300000000) {
                acqTaxRate = 0.12; ruralRate = 0.002;
                taxLabel = 'ì·¨ë“ì„¸ 12% (ì¦ì—¬Â·ì¡°ì •Â·3ì–µâ†‘)'; rateLabel = 'ì¦ì—¬ 12%';
            } else {
                acqTaxRate = 0.035; ruralRate = isOver85 ? 0.002 : 0;
                taxLabel = 'ì·¨ë“ì„¸ 3.5% (ì¦ì—¬)'; rateLabel = 'ì¦ì—¬ 3.5%';
            }
        } else {
            // ë§¤ë§¤
            if (assetType === 'commercial') {
                acqTaxRate = 0.04; ruralRate = 0.002;
                taxLabel = 'ì·¨ë“ì„¸ 4% (ìƒê°€Â·í† ì§€)'; rateLabel = 'ìƒê°€Â·í† ì§€ 4%';
            } else if (assetType === 'farmland') {
                // ë†ì§€ ì·¨ë“ì„¸
                // ì§€ë°©êµìœ¡ì„¸ ê³µì‹(ì£¼íƒì™¸): [ì·¨ë“ê°€ì•¡ Ã— (ì·¨ë“ì„¸ìœ¨ - 2%)] Ã— 20%
                // = ì·¨ë“ê°€ì•¡ Ã— (ì„¸ìœ¨ - 0.02) Ã— 0.2
                const { farmlandType } = taxState;
                if (farmlandType === 'general') {
                    // êµìœ¡ì„¸ = ì·¨ë“ê°€ì•¡ Ã— (3%-2%) Ã— 20% = ì·¨ë“ê°€ì•¡ Ã— 0.2%
                    acqTaxRate = 0.03; eduRate = -1; ruralRate = 0.002; // eduRate=-1: ë³„ë„ê³„ì‚° í”Œë˜ê·¸
                    taxLabel = 'ì·¨ë“ì„¸ 3% (ì¼ë°˜ë†ì§€Â·ë¹„ìê²½)'; rateLabel = 'ë†ì§€ 3%';
                } else if (farmlandType === 'selfcult') {
                    // ìê²½ë†ì§€ 50% ê²½ê°: ì‹¤ ì·¨ë“ì„¸ 1.5%
                    // êµìœ¡ì„¸ = ì·¨ë“ê°€ì•¡ Ã— (3%-2%) Ã— 20% Ã— 50%(ê²½ê°) = ì·¨ë“ê°€ì•¡ Ã— 0.1%
                    acqTaxRate = 0.015; eduRate = -2; ruralRate = 0; // êµìœ¡ì„¸=ì·¨ë“ê°€ì•¡Ã—0.1%
                    taxLabel = 'ì·¨ë“ì„¸ 1.5% (ìê²½ë†ì§€Â·50% ê²½ê°)'; rateLabel = 'ìê²½ë†ì§€ 1.5%';
                } else if (farmlandType === 'agcorp_new') {
                    // ë†ì—…ë²•ì¸ 75% ê²½ê°: ì‹¤ ì·¨ë“ì„¸ 0.75%
                    acqTaxRate = 0.0075; eduRate = -3; ruralRate = 0;
                    taxLabel = 'ì·¨ë“ì„¸ 0.75% (ë†ì—…ë²•ì¸Â·ì„¤ë¦½2ë…„ë‚´Â·75% ê²½ê°)'; rateLabel = 'ë†ì—…ë²•ì¸ 0.75%';
                } else if (farmlandType === 'agcorp') {
                    // ë†ì—…ë²•ì¸ 50% ê²½ê°: ì‹¤ ì·¨ë“ì„¸ 1.5%
                    acqTaxRate = 0.015; eduRate = -2; ruralRate = 0;
                    taxLabel = 'ì·¨ë“ì„¸ 1.5% (ë†ì—…ë²•ì¸Â·ì˜ë†ìš©Â·50% ê²½ê°)'; rateLabel = 'ë†ì—…ë²•ì¸ 1.5%';
                }
            } else if (assetType === 'officetel' && officetelUse === 'business') {
                acqTaxRate = 0.04; ruralRate = 0.002;
                taxLabel = 'ì·¨ë“ì„¸ 4% (ì˜¤í”¼ìŠ¤í…”Â·ì—…ë¬´ìš©)'; rateLabel = 'ì˜¤í”¼ìŠ¤í…”(ì—…ë¬´) 4%';
            } else {
                // ì£¼íƒ or ì˜¤í”¼ìŠ¤í…” ì£¼ê±°ìš©
                const { rate, label } = calcHouseTaxRate(price, houseCount, isAdjusted, isCorp);
                acqTaxRate = rate;
                taxLabel = `ì·¨ë“ì„¸ ${label}`;
                rateLabel = label;
                ruralRate = isOver85 ? 0.002 : 0;
            }
        }

        const acqTax  = price * acqTaxRate;
        // ë†ì§€ ì§€ë°©êµìœ¡ì„¸: [ì·¨ë“ê°€ì•¡ Ã— (ì·¨ë“ì„¸ìœ¨ - 2%)] Ã— 20% (ì§€ë°©ì„¸ë²• ì œ151ì¡°)
        // eduRate í”Œë˜ê·¸: -1=ì¼ë°˜ë†ì§€, -2=ìê²½/ë†ë²•ì¸50%, -3=ë†ë²•ì¸75%
        let eduTax;
        if (taxState.assetType === 'farmland') {
            if (eduRate === -1) eduTax = price * (0.03 - 0.02) * 0.2;        // 0.2%
            else if (eduRate === -2) eduTax = price * (0.03 - 0.02) * 0.2 * 0.5; // 0.1% (ê²½ê° 50%)
            else if (eduRate === -3) eduTax = price * (0.03 - 0.02) * 0.2 * 0.25;// 0.05% (ê²½ê° 75%)
            else eduTax = acqTax * eduRate;
        } else {
            eduTax = acqTax * eduRate;
        }
        const ruralTax = price * ruralRate;
        const total   = acqTax + eduTax + ruralTax;
        const effRate = (total / price * 100).toFixed(2);

        // ë±ƒì§€
        document.getElementById('taxRateBadge').textContent = `ì ìš© ì·¨ë“ì„¸ìœ¨: ${rateLabel} | ì‹¤íš¨ì„¸ìœ¨ ${effRate}%`;

        document.getElementById('acquisitionTaxLabel').textContent = taxLabel;
        document.getElementById('acquisitionTaxAmount').textContent = fmt(acqTax);
        document.getElementById('eduTaxLabel').textContent = `ì§€ë°©êµìœ¡ì„¸ (ì·¨ë“ì„¸ Ã— 10%)`;
        document.getElementById('educationTax').textContent = fmt(eduTax);
        document.getElementById('ruralTaxLabel').textContent = ruralRate > 0
            ? `ë†ì–´ì´ŒíŠ¹ë³„ì„¸ (0.2%Â·85ã¡ì´ˆê³¼)` : `ë†ì–´ì´ŒíŠ¹ë³„ì„¸ (í•´ë‹¹ì—†ìŒ)`;
        document.getElementById('ruralTax').textContent = fmt(ruralTax);
        document.getElementById('totalTax').textContent = fmt(total);

        const acqTypeNames = { buy:'ë§¤ë§¤', gift:'ì¦ì—¬', inherit:'ìƒì†' };
        let exp = `[${acqTypeNames[acqType]}] ì·¨ë“ê°€ì•¡ ${koreanAmount(price)} ê¸°ì¤€<br>`;
        exp += `ì·¨ë“ì„¸ ${fmt(acqTax)} + ì§€ë°©êµìœ¡ì„¸ ${fmt(eduTax)} + ë†íŠ¹ì„¸ ${fmt(ruralTax)}<br>`;
        exp += `= ì´ ë‚©ë¶€ì„¸ì•¡ <strong>${fmt(total)}</strong> (ì‹¤íš¨ì„¸ìœ¨ ${effRate}%)`;
        if (isOver85) exp += `<br>â€» ì „ìš©ë©´ì  85ã¡ ì´ˆê³¼ë¡œ ë†ì–´ì´ŒíŠ¹ë³„ì„¸ 0.2% ì ìš©`;
        else exp += `<br>â€» ì „ìš©ë©´ì  85ã¡ ì´í•˜ë¡œ ë†ì–´ì´ŒíŠ¹ë³„ì„¸ ë©´ì œ`;

        document.getElementById('taxExplanation').innerHTML = `<strong>ğŸ’¬ ê³„ì‚° ê²°ê³¼ í•´ì„¤</strong>${exp}`;
        document.getElementById('taxResult').classList.add('show');
    }

    function resetAcquisitionTax() {
        document.getElementById('acquisitionPrice').value = '';
        document.getElementById('taxResult').classList.remove('show');
        document.querySelectorAll('#calc-3 .amount-preview').forEach(el => el.classList.remove('show'));
        // ë²„íŠ¼ ì´ˆê¸°í™”
        taxState = { acqType:'buy', assetType:'house', isCorp:false, houseCount:1, isAdjusted:false, isOver85:false, officetelUse:'business', farmlandType:'general' };
        document.querySelectorAll('#calc-3 .btn-select-group').forEach(g => {
            const btns = g.querySelectorAll('.sel-btn');
            btns.forEach((b,i) => b.classList.toggle('active', i===0));
        });
        document.getElementById('houseOptions').style.display = 'block';
        document.getElementById('officetelUseGroup').style.display = 'none';
        document.getElementById('farmlandGroup').style.display = 'none';
        document.getElementById('houseCountGroup').style.display = 'block';
        document.getElementById('adjustedAreaGroup2').style.display = 'block';
    }

    // ========== ì¤‘ê°œìˆ˜ìˆ˜ë£Œ ==========
    function updateBrokerageInfo() {
        const t = document.getElementById('brokeragePropertyType').value;
        const info = {
            'house': 'ê±°ë˜ê¸ˆì•¡ì— ë”°ë¼ 0.4~0.9%',
            'officetel': 'ê±°ë˜ê¸ˆì•¡ì— ë”°ë¼ 0.4~0.9%',
            'commercial': 'ê±°ë˜ê¸ˆì•¡ì— ë”°ë¼ 0.4~0.9% (ìƒí•œ ë‚´ í˜‘ì˜)',
            'land': 'ê±°ë˜ê¸ˆì•¡ì— ë”°ë¼ 0.4~0.9% (ìƒí•œ ë‚´ í˜‘ì˜)'
        };
        document.getElementById('brokerageInfo').textContent = info[t] || 'ìœ í˜•ë³„ ìƒí•œìš”ìœ¨ì´ ë‹¤ë¦…ë‹ˆë‹¤';
    }

    function toggleRentFields() {
        const isRent = document.getElementById('transactionType').value === 'rent';
        document.getElementById('saleAmountGroup').style.display = isRent ? 'none' : 'block';
        document.getElementById('rentDepositGroup').style.display = isRent ? 'block' : 'none';
        document.getElementById('monthlyRentGroup').style.display = isRent ? 'block' : 'none';
    }

    function calculateBrokerage() {
        const propType = document.getElementById('brokeragePropertyType').value;
        const txType = document.getElementById('transactionType').value;
        if (!propType) { alert('ë¶€ë™ì‚° ìœ í˜•ì„ ì„ íƒí•´ì£¼ì„¸ìš”.'); return; }

        let amount = 0;
        if (txType === 'rent') {
            const dep = getVal('rentDeposit');
            const mr = getVal('monthlyRent');
            if (dep === 0 && mr === 0) { alert('ë³´ì¦ê¸ˆ ë˜ëŠ” ì›”ì„¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
            amount = dep + mr * 100;
        } else {
            amount = getVal('transactionAmount');
            if (amount === 0) { alert('ê±°ë˜ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
        }

        let rate = 0.009;
        if (propType === 'house' || propType === 'officetel') {
            if (amount < 50000000) rate = 0.006;
            else if (amount < 200000000) rate = 0.005;
            else if (amount < 600000000) rate = 0.004;
            else if (amount < 900000000) rate = 0.005;
            else if (amount < 1200000000) rate = 0.006;
            else if (amount < 1500000000) rate = 0.007;
            else rate = 0.009;
        }

        const fee = amount * rate;
        const vat = fee * 0.1;
        const total = fee + vat;

        document.getElementById('convertedAmount').textContent = fmt(amount);
        document.getElementById('appliedRate').textContent = (rate * 100).toFixed(1) + '%';
        document.getElementById('brokerageFee').textContent = fmt(fee);
        document.getElementById('brokerageVat').textContent = fmt(vat);
        document.getElementById('brokerageFeeTotal').textContent = fmt(total);

        const typeNames = {'house':'ì£¼íƒ','officetel':'ì˜¤í”¼ìŠ¤í…”','commercial':'ìƒê°€Â·ì í¬','land':'í† ì§€'};
        const txNames = {'sale':'ë§¤ë§¤','rent':'ì„ëŒ€ì°¨'};
        let exp = `${typeNames[propType]} ${txNames[txType]} ê¸°ì¤€, `;
        if (txType === 'rent') {
            exp += `í™˜ì‚° ê±°ë˜ê¸ˆì•¡ ${koreanAmount(amount)}(ë³´ì¦ê¸ˆ + ì›”ì„¸Ã—100)ì— `;
        } else {
            exp += `ê±°ë˜ê¸ˆì•¡ ${koreanAmount(amount)}ì— `;
        }
        exp += `ìƒí•œìš”ìœ¨ ${(rate*100).toFixed(1)}%ë¥¼ ì ìš©í•œ ì¤‘ê°œë³´ìˆ˜ ìƒí•œì•¡ì€ <strong>${fmt(fee)}</strong>ì…ë‹ˆë‹¤. `;
        exp += `ì—¬ê¸°ì— ë¶€ê°€ì„¸(VAT 10%) ${fmt(vat)}ë¥¼ í•©ì‚°í•˜ë©´ ì‹¤ì œ ì§€ë¶ˆê¸ˆì•¡ì€ <strong>${fmt(total)}</strong>ì…ë‹ˆë‹¤.`;
        exp += ` ë‹¨, ì¤‘ê°œë³´ìˆ˜ëŠ” ë‹¹ì‚¬ì ê°„ í˜‘ì˜ë¥¼ í†µí•´ ìƒí•œì•¡ ì´í•˜ì—ì„œ ì¡°ì • ê°€ëŠ¥í•©ë‹ˆë‹¤.`;

        document.getElementById('brokerageExplanation').innerHTML = `<strong>ğŸ’¬ ê³„ì‚° ê²°ê³¼ í•´ì„¤</strong>${exp}`;
        document.getElementById('brokerageResult').classList.add('show');
    }

    function resetBrokerage() {
        document.getElementById('brokeragePropertyType').value = '';
        document.getElementById('transactionType').value = 'sale';
        ['transactionAmount','rentDeposit','monthlyRent'].forEach(id => document.getElementById(id).value = '');
        document.getElementById('brokerageInfo').textContent = 'ìœ í˜•ë³„ ìƒí•œìš”ìœ¨ì´ ë‹¤ë¦…ë‹ˆë‹¤';
        document.getElementById('saleAmountGroup').style.display = 'block';
        document.getElementById('rentDepositGroup').style.display = 'none';
        document.getElementById('monthlyRentGroup').style.display = 'none';
        document.getElementById('brokerageResult').classList.remove('show');
        document.querySelectorAll('#calc-4 .amount-preview').forEach(el => el.classList.remove('show'));
    }

    // ========== ì ì • ì›”ì„¸ ==========
    function updateYieldRate() {
        const t = document.getElementById('yieldType').value;
        const el = document.getElementById('targetYield');
        const rates = { 'type1': 5, 'type2': 6, 'type3': 7 };
        if (t !== 'custom') { el.value = rates[t]; el.readOnly = true; }
        else { el.readOnly = false; }
    }

    function calculateProperRent() {
        const price = getVal('propertyPrice');
        const dep = getVal('rentDeposit2');
        const yld = getVal('targetYield');
        if (price === 0 || yld === 0) { alert('ë§¤ë§¤ê°€ì™€ ìˆ˜ìµë¥ ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }

        const base = price - dep;
        const rent = (yld / 100) * base / 12;

        document.getElementById('properRentPriceDisplay').textContent = fmt(price);
        document.getElementById('properRentDepositDisplay').textContent = fmt(dep);
        document.getElementById('properRentBaseDisplay').textContent = fmt(base);
        document.getElementById('properRent').textContent = fmt(rent);

        const exp = `ë§¤ë§¤ê°€ ${koreanAmount(price)}ì—ì„œ ë³´ì¦ê¸ˆ ${koreanAmount(dep)}ì„ ì œì™¸í•œ ì‹¤íˆ¬ìê¸ˆ ${koreanAmount(base)}ì— ëª©í‘œìˆ˜ìµë¥  ${yld}%ë¥¼ ì ìš©í•˜ë©´, ì ì • ì›”ì„¸ëŠ” <strong>${fmt(rent)}</strong>ì…ë‹ˆë‹¤. (${koreanAmount(base)} Ã— ${yld}% Ã· 12ê°œì›”)`;
        document.getElementById('properRentExplanation').innerHTML = `<strong>ğŸ’¬ ê³„ì‚° ê²°ê³¼ í•´ì„¤</strong>${exp}`;
        document.getElementById('properRentResult').classList.add('show');
    }

    function resetProperRent() {
        ['propertyPrice','rentDeposit2'].forEach(id => document.getElementById(id).value = '');
        document.getElementById('targetYield').value = '5';
        document.getElementById('yieldType').value = 'custom';
        document.getElementById('targetYield').readOnly = false;
        document.getElementById('properRentResult').classList.remove('show');
        document.querySelectorAll('#calc-5 .amount-preview').forEach(el => el.classList.remove('show'));
    }

    // ========== ì ì • ë§¤ë§¤ê°€ ==========
    function updateSaleYieldRate() {
        const t = document.getElementById('saleYieldType').value;
        const el = document.getElementById('saleYield');
        const rates = { 'type1': 5, 'type2': 6, 'type3': 7 };
        if (t !== 'custom') { el.value = rates[t]; el.readOnly = true; }
        else { el.readOnly = false; }
    }

    function calculateProperPrice() {
        const dep = getVal('saleDeposit');
        const mr = getVal('saleMonthlyRent');
        const yld = getVal('saleYield');
        if (mr === 0 || yld === 0) { alert('ì›”ì„¸ì™€ ìˆ˜ìµë¥ ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }

        const annual = mr * 12;
        const properPrice = (annual / (yld / 100)) + dep;

        document.getElementById('properPriceRentDisplay').textContent = fmt(mr);
        document.getElementById('properPriceAnnualDisplay').textContent = fmt(annual);
        document.getElementById('properPriceDepositDisplay').textContent = fmt(dep);
        document.getElementById('properPrice').textContent = fmt(properPrice);

        const exp = `ì›”ì„¸ ${koreanAmount(mr)} Ã— 12ê°œì›” = ì—°ê°„ ì„ëŒ€ìˆ˜ìµ ${koreanAmount(annual)}ë¥¼ ìˆ˜ìµë¥  ${yld}%ë¡œ ë‚˜ëˆ„ë©´ íˆ¬ìì›ê¸ˆ ${koreanAmount(Math.round(annual/(yld/100)))}ì´ ì‚°ì¶œë©ë‹ˆë‹¤. ì—¬ê¸°ì— ë³´ì¦ê¸ˆ ${koreanAmount(dep)}ì„ ë”í•œ ì ì • ë§¤ë§¤ê°€ëŠ” <strong>${fmt(properPrice)}</strong>ì…ë‹ˆë‹¤.`;
        document.getElementById('properPriceExplanation').innerHTML = `<strong>ğŸ’¬ ê³„ì‚° ê²°ê³¼ í•´ì„¤</strong>${exp}`;
        document.getElementById('properPriceResult').classList.add('show');
    }

    function resetProperPrice() {
        ['saleDeposit','saleMonthlyRent'].forEach(id => document.getElementById(id).value = '');
        document.getElementById('saleYield').value = '5';
        document.getElementById('saleYieldType').value = 'custom';
        document.getElementById('saleYield').readOnly = false;
        document.getElementById('properPriceResult').classList.remove('show');
        document.querySelectorAll('#calc-6 .amount-preview').forEach(el => el.classList.remove('show'));
    }
</script>
</body>
</html>
